import{av as ie,Q as K,I as xe,g as R,y as Be,F as de,e as se,l as $,K as le,r as p,o as a,c,b as o,t as y,a as r,L as ke,m as s,w as d,q as j,n as P,U as D,H as re,an as he,x as Ie,ab as ye,h as L,i as oe,aO as fe,a4 as ne,aw as Se,k as ge,S as H,T as ae,p as F,aa as A,a9 as J,J as be,O as Ce,aT as De,E as Y,aU as Te,aV as Me,aW as Ve,aX as je,ai as Ee,az as Ne,V as qe,u as Le,z as Oe,M as Ue,s as Fe}from"./main.d0ffa6eb.js";import{D as Ae,d as ze}from"./DragIcon.e0a4ab5f.js";import{_ as We}from"./ItemUnitModal.dc6156ec.js";import{_ as Ye}from"./SelectNotePopup.f61bb6cc.js";const Re={class:"flex items-center justify-between mb-3"},Ge={class:"flex items-center text-base",style:{flex:"4"}},Xe={class:"pr-2 mb-0",align:"right"},He={class:"absolute left-3.5"},Je={class:"ml-2 text-sm leading-none text-primary-400 cursor-pointer"},Ke=o("br",null,null,-1),Qe={class:"text-sm text-right",style:{flex:"3"}},Ze={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},et={props:{discount:{type:Object,default:0},ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(e,{emit:n}){const t=e,f=ie(),w=K(),I=xe(),h=R(null),m=Be({...t.taxData});de("utils");const{t:V}=se(),C=$(()=>f.taxTypes.map(b=>({...b})).map(b=>(t.taxes.find(x=>x.tax_type_id===b.id)&&(b.disabled=!0),b))),B=$(()=>m.compound_tax&&t.total?(t.total+t.totalTax)*m.percent/100:t.total&&m.percent?(t.total-t.discount)*m.percent/100:0);le(()=>t.total,()=>{k()}),le(()=>t.discount,()=>{k()}),le(()=>t.totalTax,()=>{k()}),t.taxData.tax_type_id>0&&(h.value=f.taxTypes.find(u=>u.id===t.taxData.tax_type_id)),k();function T(u){m.percent=u.percent,m.tax_type_id=u.id,m.compound_tax=u.compound_tax,m.name=u.name,k()}function k(){m.tax_type_id!==0&&n("update",{index:t.index,item:{...m,amount:B.value}})}function i(){let u={itemIndex:t.itemIndex,taxIndex:t.index};w.openModal({title:V("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:u,size:"sm"})}function g(u){t.store.$patch(b=>{b[t.storeProp].items[t.itemIndex].taxes.splice(u,1)})}return(u,b)=>{const M=p("BaseIcon"),x=p("BaseMultiselect"),S=p("BaseFormatMoney");return a(),c("div",Re,[o("div",Ge,[o("label",Xe,y(u.$t("invoices.item.tax")),1),r(x,{modelValue:h.value,"onUpdate:modelValue":[b[0]||(b[0]=v=>h.value=v),b[1]||(b[1]=v=>T(v))],"value-prop":"id",options:s(C),placeholder:u.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},ke({singlelabel:d(({value:v})=>[o("div",He,y(v.name)+" - "+y(v.percent)+" % ",1)]),option:d(({option:v})=>[j(y(v.name)+" - "+y(v.percent)+" % ",1)]),_:2},[s(I).hasAbilities(e.ability)?{name:"action",fn:d(()=>[o("button",{type:"button",class:"flex items-center justify-center w-full px-2 cursor-pointer py-2 bg-gray-200 border-none outline-none",onClick:i},[r(M,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),o("label",Je,y(u.$t("invoices.add_new_tax")),1)])])}:void 0]),1032,["modelValue","options","placeholder"]),Ke]),o("div",Qe,[r(S,{amount:s(B),currency:e.currency},null,8,["amount","currency"])]),o("div",Ze,[e.taxes.length&&e.index!==e.taxes.length-1?(a(),P(M,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:b[2]||(b[2]=v=>g(e.index))})):D("",!0)])])}}},tt={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},ot={colspan:"6",class:"p-0 text-left align-top"},nt={class:"w-full"},at=o("col",{style:{width:"30%"}},null,-1),st=o("col",{style:{width:"15%"}},null,-1),rt=o("col",{style:{width:"15%"}},null,-1),lt=o("col",{style:{width:"15%"}},null,-1),it={key:0,style:{width:"20%"}},dt={key:1,style:{width:"20%"}},ct=o("col",{style:{width:"20%"}},null,-1),ut={class:"px-5 py-4 text-left align-top"},mt={class:"flex justify-start"},pt={class:"flex items-center justify-center w-5 h-5 mt-2 text-gray-300 cursor-move handle mr-2"},yt={class:"px-5 py-4 text-right align-top"},ft={class:"px-5 py-4 text-right align-top"},xt={class:"px-5 py-4 text-left align-top"},ht={class:"flex flex-col"},gt={class:"flex-auto flex-fill bd-highlight"},bt={class:"relative w-full"},vt={key:0,class:"px-5 py-4 text-left align-top"},_t={class:"flex flex-col"},$t={class:"flex",role:"group"},wt={class:"flex items-center"},Pt={key:1,class:"px-5 py-4 text-left align-top"},Bt={class:"flex flex-col"},kt={class:"flex",role:"group"},It={class:"flex items-center"},St={key:0,class:"px-5 py-4 text-right align-top"},Ct={class:"flex items-center justify-end text-sm"},Dt={class:"flex items-center justify-center w-6 h-10 mx-2"},Tt={key:0},Mt=o("td",{class:"px-5 py-4 text-left align-top"},null,-1),Vt={colspan:"4",class:"px-5 py-4 text-left align-top"},jt={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""},isDraftMode:{type:Boolean,default:!0}},emits:["update","remove","itemValidate"],setup(e,{emit:n}){const t=e,f=K(),w=re(),I=he();Ie();const{t:h}=se(),m=$({get:()=>t.itemData.quantity,set:l=>{E("quantity",parseFloat(l))}}),V=$({get:()=>t.itemData.unit_name,set:l=>{E("unit_name",l)}}),C=$({get:()=>{const l=t.itemData.price;return parseFloat(l)>0?l/100:l},set:l=>{if(parseFloat(l)>0){let _=Math.round(l*100);E("price",_)}else E("price",l)}}),B=$(()=>t.itemData.price*t.itemData.quantity),T=$({get:()=>t.itemData.discount,set:l=>{t.itemData.discount_type==="percentage"?E("discount_val",B.value*l/100):E("discount_val",Math.round(l*100)),E("discount",l)}});async function k(){f.openModal({title:h("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}const i=$(()=>(console.log("subtotal.value | props.itemData.discount_val"),console.log(B.value/100+" | "+t.itemData.discount_val/100),B.value-t.itemData.discount_val)),g=$(()=>t.currency?t.currency:w.selectedCompanyCurrency),u=$(()=>t.store[t.storeProp].items.length!=1),b=$(()=>Math.round(ye.exports.sumBy(t.itemData.taxes,function(l){return l.compound_tax?0:l.amount}))),M=$(()=>Math.round(ye.exports.sumBy(t.itemData.taxes,function(l){return l.compound_tax?l.amount:0}))),x=$(()=>b.value+M.value),S={name:{required:L.withMessage(h("validation.required"),oe)},quantity:{required:L.withMessage(h("validation.required"),oe),minValue:L.withMessage(h("validation.qty_must_greater_than_zero"),fe(1)),maxLength:L.withMessage(h("validation.amount_maxlength"),ne(20))},price:{required:L.withMessage(h("validation.required"),oe),minValue:L.withMessage(h("validation.number_length_minvalue"),fe(1)),maxLength:L.withMessage(h("validation.price_maxlength"),ne(20))},discount_val:{between:L.withMessage(h("validation.discount_maxlength"),Se(0,$(()=>B.value)))},description:{maxLength:L.withMessage(h("validation.notes_maxlength"),ne(65e3))}},v=ge(S,$(()=>t.store[t.storeProp].items[t.index]),{$scope:t.itemValidationScope});function G(l){t.store.$patch(_=>{_[t.storeProp].items[t.index].taxes[l.index]=l.item}),t.itemData.taxes[t.itemData.taxes.length-1],z()}function O(l){E("name",l)}function q(l){t.store.$patch(_=>{if(_[t.storeProp].items[t.index].name=l.name,_[t.storeProp].items[t.index].price=l.price,_[t.storeProp].items[t.index].item_id=l.id,_[t.storeProp].items[t.index].description=l.description,l.unit&&(_[t.storeProp].items[t.index].unit_name=l.unit.name),t.store[t.storeProp].tax_per_item==="YES"&&l.taxes){let W=0;l.taxes.forEach(X=>{G({index:W,item:{...X}}),W++})}_[t.storeProp].exchange_rate&&(_[t.storeProp].items[t.index].price/=_[t.storeProp].exchange_rate)}),I.fetchItems(),z()}function U(){t.itemData.discount_type!=="fixed"&&(E("discount_val",Math.round(t.itemData.discount*100)),E("discount_type","fixed"))}function Q(){t.itemData.discount_type!=="percentage"&&(E("discount_val",B.value*t.itemData.discount/100),E("discount_type","percentage"))}function z(){let l=t.store[t.storeProp]?.items[t.index]?.taxes;l||(l=[]);let _={...t.store[t.storeProp].items[t.index],index:t.index,total:i.value,sub_total:B.value,totalSimpleTax:b.value,totalCompoundTax:M.value,totalTax:x.value,tax:x.value,taxes:[...l]};t.store.updateItem(_)}function E(l,_){t.store.$patch(W=>{W[t.storeProp].items[t.index][l]=_}),z()}function Z(){}return(l,_)=>{const W=p("BaseItemSelect"),X=p("BaseInput"),ee=p("BaseIcon"),ve=p("BaseSelectAction"),_e=p("BaseMultiselect"),$e=p("BaseMoney"),ce=p("BaseButton"),te=p("BaseDropdownItem"),ue=p("BaseDropdown"),me=p("BaseContentPlaceholdersText"),pe=p("BaseContentPlaceholders"),we=p("BaseFormatMoney");return a(),c(A,null,[r(We),o("tr",tt,[o("td",ot,[o("table",nt,[o("colgroup",null,[at,st,rt,lt,H(o("span",null,[e.storeProp=="newEstimate"||e.store[e.storeProp].discount_per_item==="YES"?(a(),c("col",it)):(a(),c("col",dt))],512),[[ae,e.storeProp=="newInvoice"||e.storeProp=="newProforma"||e.storeProp=="newPurchase"||e.storeProp=="newEstimate"]]),ct]),o("tbody",null,[o("tr",null,[o("td",ut,[o("div",mt,[o("div",pt,[r(Ae)]),r(W,{disabled:!e.isDraftMode,type:"Invoice",item:e.itemData,invalid:s(v).name.$error,"invalid-description":s(v).description.$error,taxes:e.itemData.taxes,index:e.index,"store-prop":e.storeProp,"is-draft-mode":e.isDraftMode,store:e.store,onSearch:O,onSelect:q},null,8,["disabled","item","invalid","invalid-description","taxes","index","store-prop","is-draft-mode","store"])])]),o("td",yt,[r(X,{disabled:!e.isDraftMode,modelValue:s(m),"onUpdate:modelValue":_[0]||(_[0]=N=>F(m)?m.value=N:null),invalid:s(v).quantity.$error,"content-loading":e.loading,type:"number",small:"",min:"1",step:"any",onChange:Z,onInput:_[1]||(_[1]=N=>s(v).quantity.$touch())},null,8,["disabled","modelValue","invalid","content-loading"])]),o("td",ft,[r(_e,{disabled:!e.isDraftMode,modelValue:s(V),"onUpdate:modelValue":_[2]||(_[2]=N=>F(V)?V.value=N:null),"content-loading":l.isFetchingInitialData,label:"name",options:s(I).itemUnits,"value-prop":"name","can-deselect":!1,"can-clear":!1,placeholder:l.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:d(()=>[r(ve,{onClick:k},{default:d(()=>[r(ee,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),j(" "+y(l.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["disabled","modelValue","content-loading","options","placeholder"])]),o("td",xt,[o("div",ht,[o("div",gt,[o("div",bt,[(a(),P($e,{disabled:!e.isDraftMode,key:s(g),modelValue:s(C),"onUpdate:modelValue":_[3]||(_[3]=N=>F(C)?C.value=N:null),invalid:s(v).price.$error,"content-loading":e.loading,currency:s(g),onChange:Z},null,8,["disabled","modelValue","invalid","content-loading","currency"]))])])])]),H(o("span",null,[e.storeProp=="newEstimate"||e.store[e.storeProp].discount_per_item==="YES"?(a(),c("td",vt,[o("div",_t,[o("div",$t,[r(X,{disabled:!e.isDraftMode,modelValue:s(T),"onUpdate:modelValue":_[4]||(_[4]=N=>F(T)?T.value=N:null),invalid:s(v).discount_val.$error,"content-loading":e.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px] w-16"},null,8,["disabled","modelValue","invalid","content-loading"]),r(ue,{position:"bottom-end",class:"w-16"},{activator:d(()=>[r(ce,{"content-loading":e.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:d(()=>[o("span",wt,[j(y(e.itemData.discount_type=="fixed"?e.currency.symbol:"%")+" ",1),r(ee,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1},8,["content-loading"])]),default:d(()=>[e.isDraftMode?(a(),P(te,{key:0,onClick:U},{default:d(()=>[j(y(l.$t("general.fixed")),1)]),_:1})):D("",!0),e.isDraftMode?(a(),P(te,{key:1,onClick:Q},{default:d(()=>[j(y(l.$t("general.percentage")),1)]),_:1})):D("",!0)]),_:1})])])])):e.storeProp!="newEstimate"?(a(),c("td",Pt,[o("div",Bt,[o("div",kt,[r(X,{disabled:!e.isDraftMode,modelValue:s(T),"onUpdate:modelValue":_[5]||(_[5]=N=>F(T)?T.value=N:null),invalid:s(v).discount_val.$error,"content-loading":e.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px] w-16"},null,8,["disabled","modelValue","invalid","content-loading"]),r(ue,{position:"bottom-end",class:"w-16"},{activator:d(()=>[r(ce,{"content-loading":e.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:d(()=>[o("span",It,[j(y(e.itemData.discount_type=="fixed"?e.currency.symbol:"%")+" ",1),r(ee,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1},8,["content-loading"])]),default:d(()=>[e.isDraftMode?(a(),P(te,{key:0,onClick:U},{default:d(()=>[j(y(l.$t("general.fixed")),1)]),_:1})):D("",!0),e.isDraftMode?(a(),P(te,{key:1,onClick:Q},{default:d(()=>[j(y(l.$t("general.percentage")),1)]),_:1})):D("",!0)]),_:1})])])])):D("",!0)],512),[[ae,e.storeProp=="newInvoice"||e.storeProp=="newProforma"||e.storeProp=="newPurchase"||e.storeProp=="newEstimate"]]),e.isDraftMode?(a(),c("td",St,[o("div",Ct,[o("span",null,[e.loading?(a(),P(pe,{key:0},{default:d(()=>[r(me,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),P(we,{key:1,amount:s(i),currency:"false"},null,8,["amount"]))]),o("div",Dt,[s(u)?(a(),P(ee,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:_[6]||(_[6]=N=>e.store.removeItem(e.index))})):D("",!0)])])])):D("",!0)]),e.store[e.storeProp].tax_per_item==="YES"?(a(),c("tr",Tt,[Mt,o("td",Vt,[e.loading?(a(),P(pe,{key:0},{default:d(()=>[r(me,{lines:1,class:"w-24 h-8 rounded-md border"})]),_:1})):(a(!0),c(A,{key:1},J(e.itemData.taxes,(N,Pe)=>(a(),P(et,{key:N.id,index:Pe,"item-index":e.index,"tax-data":N,taxes:e.itemData.taxes,"discounted-total":s(i),"total-tax":s(b),total:s(B),discount:e.itemData.discount_val,currency:e.currency,"update-items":z,ability:s(be).CREATE_INVOICE,store:e.store,"store-prop":e.storeProp,onUpdate:G},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","discount","currency","ability","store","store-prop"]))),128))])])):D("",!0)])])])])],64)}}},Et={class:"text-center item-table min-w-full"},Nt=o("col",{style:{width:"30%"}},null,-1),qt=o("col",{style:{width:"15%"}},null,-1),Lt=o("col",{style:{width:"15%"}},null,-1),Ot=o("col",{style:{width:"15%"}},null,-1),Ut={key:0,style:{width:"20%"}},Ft={key:1,style:{width:"20%"}},At=o("col",{style:{width:"20%"}},null,-1),zt={class:"bg-white border border-gray-200 border-solid"},Wt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Yt={key:1,class:"pl-7"},Rt={class:"px-8 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Gt={key:1},Xt={class:"px-8 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Ht={key:1},Jt={class:"px-8 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Kt={key:1},Qt={key:0,class:"px-8 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Zt={key:1},eo={key:1,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},to={key:1},oo={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},no={key:1,class:"pr-10 column-heading"},Qo={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""},isDraftMode:{type:Boolean,default:!0}},setup(e){const n=e,t=re(),f=$(()=>n.currency?n.currency:t.selectedCompanyCurrency);return(w,I)=>{const h=p("BaseContentPlaceholdersText"),m=p("BaseContentPlaceholders"),V=p("BaseIcon");return a(),c(A,null,[o("table",Et,[o("colgroup",null,[Nt,qt,Lt,Ot,H(o("span",null,[e.store[e.storeProp].discount_per_item==="YES"?(a(),c("col",Ut)):e.storeProp!="newEstimate"?(a(),c("col",Ft)):D("",!0)],512),[[ae,e.storeProp=="newInvoice"||e.storeProp=="newProforma"||e.storeProp=="newPurchase"||e.storeProp=="newEstimate"]]),At]),o("thead",zt,[o("tr",null,[o("th",Wt,[e.isLoading?(a(),P(m,{key:0},{default:d(()=>[r(h,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),c("span",Yt,y(w.$t("invoices.item.item")),1))]),o("th",Rt,[e.isLoading?(a(),P(m,{key:0},{default:d(()=>[r(h,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),c("span",Gt,y(w.$t("invoices.item.quantity")),1))]),o("th",Xt,[e.isLoading?(a(),P(m,{key:0},{default:d(()=>[r(h,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),c("span",Ht,y(w.$t("invoices.item.uom")),1))]),o("th",Jt,[e.isLoading?(a(),P(m,{key:0},{default:d(()=>[r(h,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),c("span",Kt,y(w.$t("invoices.item.price")),1))]),H(o("span",null,[e.storeProp=="newEstimate"||e.store[e.storeProp].discount_per_item==="YES"?(a(),c("th",Qt,[e.isLoading?(a(),P(m,{key:0},{default:d(()=>[r(h,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),c("span",Zt,y(w.$t("invoices.item.discount")),1))])):e.storeProp!="newEstimate"?(a(),c("th",eo,[e.isLoading?(a(),P(m,{key:0},{default:d(()=>[r(h,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),c("span",to,y(w.$t("invoices.item.deduction")),1))])):D("",!0)],512),[[ae,e.storeProp=="newInvoice"||e.storeProp=="newProforma"||e.storeProp=="newPurchase"||e.storeProp=="newEstimate"]]),o("th",oo,[e.isLoading?(a(),P(m,{key:0},{default:d(()=>[r(h,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),c("span",no,y(w.$t("invoices.item.amount")),1))])])]),r(s(ze),{modelValue:e.store[e.storeProp].items,"onUpdate:modelValue":I[0]||(I[0]=C=>e.store[e.storeProp].items=C),"item-key":"id",tag:"tbody",handle:".handle"},{item:d(({element:C,index:B})=>[(a(),P(jt,{key:C.id,index:B,"item-data":C,loading:e.isLoading,currency:s(f),"item-validation-scope":e.itemValidationScope,"invoice-items":e.store[e.storeProp].items,store:e.store,"store-prop":e.storeProp,"is-draft-mode":e.isDraftMode},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop","is-draft-mode"]))]),_:1},8,["modelValue"])]),e.isDraftMode?(a(),c("div",{key:0,class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:I[1]||(I[1]=(...C)=>e.store.addItem&&e.store.addItem(...C))},[r(V,{name:"PlusCircleIcon",class:"mr-2"}),j(" "+y(w.$t("general.add_new_item")),1)])):D("",!0)],64)}}},ao={class:"flex items-center justify-between w-full mt-2 text-sm"},so={class:"font-semibold leading-5 text-gray-500 uppercase"},ro={class:"flex items-center justify-center text-lg text-black"},lo={props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(e,{emit:n}){const t=e;de("$utils");const f=$(()=>t.tax.compound_tax&&t.store.getSubtotalWithDiscount?Math.round((t.store.getSubtotalWithDiscount+t.store.getTotalSimpleTax)*t.tax.percent/100):t.store.getSubtotalWithDiscount&&t.tax.percent?Math.round(t.store.getSubtotalWithDiscount*t.tax.percent/100):0);Ce(()=>{t.store.getSubtotalWithDiscount&&w(),t.store.getTotalSimpleTax&&w()});function w(){n("update",{...t.tax,amount:f.value})}return(I,h)=>{const m=p("BaseFormatMoney"),V=p("BaseIcon");return a(),c("div",ao,[o("label",so,y(e.tax.name)+" ("+y(e.tax.percent)+" %) ",1),o("label",ro,[r(m,{amount:e.tax.amount,currency:e.currency},null,8,["amount","currency"]),r(V,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:h[0]||(h[0]=C=>I.$emit("remove",e.tax.id))})])])}}},io={class:"w-full mt-4 tax-select"},co={class:"relative w-full max-w-md px-4"},uo={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},mo={class:"relative bg-white"},po={class:"relative p-4"},yo={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},fo=["onClick"],xo={class:"flex justify-between px-2"},ho={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},go={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},bo={key:1,class:"flex justify-center p-5 text-gray-400"},vo={class:"text-base text-gray-500 cursor-pointer"},_o={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},$o={props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(e,{emit:n}){const t=e,f=K(),w=ie(),I=xe(),{t:h}=se(),m=R(null),V=$(()=>m.value?w.taxTypes.filter(function(k){return k.name.toLowerCase().indexOf(m.value.toLowerCase())!==-1}):w.taxTypes),C=$(()=>t.store[t.storeProp].taxes);function B(k,i){n("select:taxType",{...k}),i()}function T(){f.openModal({title:h("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:k=>n("select:taxType",k)})}return(k,i)=>{const g=p("BaseIcon"),u=p("BaseInput");return a(),c("div",io,[r(s(Ve),{class:"relative"},{default:d(({isOpen:b})=>[r(s(De),{class:Y([b?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:d(()=>[r(g,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),j(" "+y(k.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),o("div",co,[r(Te,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:d(()=>[r(s(Me),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 transform -translate-x-full sm:px-0"},{default:d(({close:M})=>[o("div",uo,[o("div",mo,[o("div",po,[r(u,{modelValue:m.value,"onUpdate:modelValue":i[0]||(i[0]=x=>m.value=x),placeholder:k.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),s(V).length>0?(a(),c("div",yo,[(a(!0),c(A,null,J(s(V),(x,S)=>(a(),c("div",{key:S,class:Y([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":s(C).find(v=>v.tax_type_id===x.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:v=>B(x,M)},[o("div",xo,[o("label",ho,y(x.name),1),o("label",go,y(x.percent)+" % ",1)])],10,fo))),128))])):(a(),c("div",bo,[o("label",vo,y(k.$t("general.no_tax_found")),1)]))]),s(I).hasAbilities(s(be).CREATE_TAX_TYPE)?(a(),c("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:T},[r(g,{name:"CheckCircleIcon",class:"text-primary-400"}),o("label",_o,y(k.$t("estimates.add_new_tax")),1)])):D("",!0)])]),_:1})]),_:1})])]),_:1})])}}},wo={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},Po={class:"flex items-center justify-between w-full"},Bo={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},ko={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},Io={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},So={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"};const Co={key:1},Do={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},To={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},Mo={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},Zo={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(e){const n=e,t=R(null);de("$utils");const f=re(),w=$({get:()=>n.store[n.storeProp].discount,set:i=>{n.store[n.storeProp].discount_type==="percentage"?n.store[n.storeProp].discount_val=Math.round(n.store.getSubTotal*i/100):n.store[n.storeProp].discount_val=Math.round(i*100),n.store[n.storeProp].discount=i}}),I=$({get:()=>n.store[n.storeProp].taxes,set:i=>{n.store.$patch(g=>{g[n.storeProp].taxes=i})}}),h=$(()=>{let i=[];return n.store[n.storeProp].items.forEach(g=>{g.taxes&&g.taxes.forEach(u=>{let b=i.find(M=>M.tax_type_id===u.tax_type_id);b?b.amount+=u.amount:u.tax_type_id&&i.push({tax_type_id:u.tax_type_id,amount:u.amount,percent:u.percent,name:u.name})})}),i}),m=$(()=>n.currency?n.currency:f.selectedCompanyCurrency);function V(){n.store[n.storeProp].discount_type!=="fixed"&&(n.store[n.storeProp].discount_val=Math.round(n.store[n.storeProp].discount*100),n.store[n.storeProp].discount_type="fixed")}function C(){n.store[n.storeProp].discount_type!=="percentage"&&(n.store[n.storeProp].discount_val=n.store.getSubTotal*n.store[n.storeProp].discount/100,n.store[n.storeProp].discount_type="percentage")}function B(i){let g=0;i.compound_tax&&n.store.getSubtotalWithDiscount?g=Math.round((n.store.getSubtotalWithDiscount+n.store.getTotalSimpleTax)*i.percent/100):n.store.getSubtotalWithDiscount&&i.percent&&(g=Math.round(n.store.getSubtotalWithDiscount*i.percent/100));let u={...je,id:Ee.raw(),name:i.name,percent:i.percent,compound_tax:i.compound_tax,tax_type_id:i.id,amount:g};n.store.$patch(b=>{b[n.storeProp].taxes.push({...u})})}function T(i){const g=n.store[n.storeProp].taxes.find(u=>u.id===i.id);g&&Object.assign(g,{...i})}function k(i){const g=n.store[n.storeProp].taxes.findIndex(u=>u.id===i);n.store.$patch(u=>{u[n.storeProp].taxes.splice(g,1)})}return(i,g)=>{const u=p("BaseContentPlaceholdersText"),b=p("BaseContentPlaceholders"),M=p("BaseFormatMoney"),x=p("BaseInput"),S=p("BaseIcon"),v=p("BaseButton"),G=p("BaseDropdownItem"),O=p("BaseDropdown");return a(),c("div",wo,[o("div",Po,[e.isLoading?(a(),P(b,{key:0},{default:d(()=>[r(u,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),c("label",Bo,y(i.$t("estimates.sub_total")),1)),e.isLoading?(a(),P(b,{key:2},{default:d(()=>[r(u,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),c("label",ko,[r(M,{amount:e.store.getSubTotal,currency:s(m)},null,8,["amount","currency"])]))]),(a(!0),c(A,null,J(s(h),q=>(a(),c("div",{key:q.tax_type_id,class:"flex items-center justify-between w-full"},[e.isLoading?(a(),P(b,{key:0},{default:d(()=>[r(u,{lines:1,class:"w-16 h-5"})]),_:1})):e.store[e.storeProp].tax_per_item==="YES"?(a(),c("label",Io,y(q.name)+" - "+y(q.percent)+"% ",1)):D("",!0),e.isLoading?(a(),P(b,{key:2},{default:d(()=>[r(u,{lines:1,class:"w-16 h-5"})]),_:1})):e.store[e.storeProp].tax_per_item==="YES"?(a(),c("label",So,[r(M,{amount:q.amount,currency:s(m)},null,8,["amount","currency"])])):D("",!0)]))),128)),(e.store[e.storeProp].discount_per_item==="NO"||e.store[e.storeProp].discount_per_item,D("",!0)),e.store[e.storeProp].tax_per_item==="NO"||e.store[e.storeProp].tax_per_item===null?(a(),c("div",Co,[(a(!0),c(A,null,J(s(I),(q,U)=>(a(),P(lo,{key:q.id,index:U,tax:q,taxes:s(I),currency:e.currency,store:e.store,onRemove:k,onUpdate:T},null,8,["index","tax","taxes","currency","store"]))),128))])):D("",!0),e.store[e.storeProp].tax_per_item==="NO"||e.store[e.storeProp].tax_per_item===null?(a(),c("div",{key:2,ref_key:"taxModal",ref:t,class:"float-right pt-2 pb-4"},[r($o,{"store-prop":e.storeProp,store:e.store,type:e.taxPopupType,"onSelect:taxType":B},null,8,["store-prop","store","type"])],512)):D("",!0),o("div",Do,[e.isLoading?(a(),P(b,{key:0},{default:d(()=>[r(u,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),c("label",To,y(i.$t("estimates.total"))+" "+y(i.$t("estimates.amount"))+":",1)),e.isLoading?(a(),P(b,{key:2},{default:d(()=>[r(u,{lines:1,class:"w-16 h-5"})]),_:1})):(a(),c("label",Mo,[r(M,{amount:e.store.getTotal,currency:s(m)},null,8,["amount","currency"])]))])])}}},Vo={class:"mb-6"},jo={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},Eo={class:"text-primary-800 font-medium mb-4 text-sm"},en={props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(e){const n=e;function t(f){n.store[n.storeProp].notes=""+f.notes,n.store[n.storeProp].notes_heading=""+f.name}return(f,w)=>{const I=p("BaseCustomInput");return a(),c("div",Vo,[o("div",jo,[r(Ye,{type:e.type,onSelect:t},null,8,["type"])]),o("label",Eo,y(f.$t("invoices.notes")),1),r(I,{modelValue:e.store[e.storeProp].notes,"onUpdate:modelValue":w[0]||(w[0]=h=>e.store[e.storeProp].notes=h),"content-loading":e.store.isFetchingInitialSettings,fields:e.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"]),H(o("input",{type:"hidden","onUpdate:modelValue":w[1]||(w[1]=h=>e.store[e.storeProp].notes_heading=h)},null,512),[[Ne,e.store[e.storeProp].notes_heading]])])}}};var No="/build/img/tick.png";const qo={class:"flex justify-between w-full"},Lo={class:"px-8 py-8 sm:p-6"},Oo={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},Uo=["src","alt","onClick"],Fo=["alt"],Ao={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},tn={setup(e){const n=K(),t=R(""),f=$(()=>n.active&&n.componentName==="SelectTemplate"),w=$(()=>n.title);function I(){n.data.store[n.data.storeProp].template_name?t.value=n.data.store[n.data.storeProp].template_name:t.value=n.data.templates[0]}async function h(){await n.data.store.setTemplate(t.value),m()}function m(){n.closeModal(),setTimeout(()=>{n.$reset()},300)}return(V,C)=>{const B=p("BaseIcon"),T=p("BaseButton"),k=p("BaseModal");return a(),P(k,{show:s(f),onClose:m,onOpen:I},{header:d(()=>[o("div",qo,[j(y(s(w))+" ",1),r(B,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:m})])]),default:d(()=>[o("div",Lo,[s(n).data?(a(),c("div",Oo,[(a(!0),c(A,null,J(s(n).data.templates,(i,g)=>(a(),c("div",{key:g,class:Y([{"border border-solid border-primary-500":t.value===i.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"])},[o("img",{src:i.path,alt:i.name,class:"w-full",onClick:u=>t.value=i.name},null,8,Uo),t.value===i.name?(a(),c("img",{key:0,alt:i.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:No},null,8,Fo)):D("",!0),o("span",{class:Y(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":t.value===i.name,"text-gray-600":t.value!=i.name}])},y(i.name),3)],2))),128))])):D("",!0)]),o("div",Ao,[r(T,{class:"mr-3",variant:"primary-outline",onClick:m},{default:d(()=>[j(y(V.$t("general.cancel")),1)]),_:1}),r(T,{variant:"primary",onClick:C[0]||(C[0]=i=>h())},{left:d(i=>[r(B,{name:"SaveIcon",class:Y(i.class)},null,8,["class"])]),default:d(()=>[j(" "+y(V.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},zo={class:"flex justify-between w-full"},Wo={class:"item-modal"},Yo=["onSubmit"],Ro={class:"px-8 py-8 sm:p-6"},Go={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},on={emits:["newItem"],setup(e,{emit:n}){const t=K(),f=he(),w=re(),I=ie();qe(),Le();const{t:h}=se(),m=R(!1),V=R(w.selectedCompanySettings.tax_per_item),C=$(()=>t.active&&t.componentName==="ItemModal"),B=$({get:()=>f.currentItem.price/100,set:x=>{f.currentItem.price=Math.round(x*100)}}),T=$({get:()=>f?.currentItem?.taxes?.map(x=>{if(x)return{...x,tax_type_id:x.id,tax_name:x.name+" ("+x.percent+"%)"}})[0],set:x=>{f.currentItem.taxes=[x]}}),k=$(()=>V.value==="YES"),i={name:{required:L.withMessage(h("validation.required"),oe),minLength:L.withMessage(h("validation.name_min_length",{count:3}),Oe(3))},description:{maxLength:L.withMessage(h("validation.description_maxlength",{count:255}),ne(255))}},g=ge(i,$(()=>f.currentItem)),u=$(()=>I.taxTypes.map(x=>({...x,tax_name:x.name+" ("+x.percent+"%)"})));Ue(()=>{g.value.$reset(),f.fetchItemUnits({limit:"all"})});async function b(){if(g.value.$touch(),g.value.$invalid)return!0;let x={...f.currentItem,taxes:f.currentItem.taxes.map(v=>({tax_type_id:v.id,amount:B.value*v.percent/100,percent:v.percent,name:v.name,collective_tax:0}))};m.value=!0,await(f.isEdit?f.updateItem:f.addItem)(x).then(v=>{m.value=!1,v.data.data&&t.data&&t.refreshData(v.data.data),M()})}function M(){t.closeModal(),setTimeout(()=>{f.resetCurrentItem(),t.$reset(),g.value.$reset()},300)}return(x,S)=>{const v=p("BaseIcon"),G=p("BaseInput"),O=p("BaseInputGroup"),q=p("BaseMoney"),U=p("BaseMultiselect"),Q=p("BaseTextarea"),z=p("BaseInputGrid"),E=p("BaseButton"),Z=p("BaseModal");return a(),P(Z,{show:s(C),onClose:M},{header:d(()=>[o("div",zo,[j(y(s(t).title)+" ",1),r(v,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:M})])]),default:d(()=>[o("div",Wo,[o("form",{action:"",onSubmit:Fe(b,["prevent"])},[o("div",Ro,[r(z,{layout:"one-column"},{default:d(()=>[r(O,{label:x.$t("items.name"),required:"",error:s(g).name.$error&&s(g).name.$errors[0].$message},{default:d(()=>[r(G,{modelValue:s(f).currentItem.name,"onUpdate:modelValue":S[0]||(S[0]=l=>s(f).currentItem.name=l),type:"text",invalid:s(g).name.$error,onInput:S[1]||(S[1]=l=>s(g).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),r(O,{label:x.$t("items.price")},{default:d(()=>[(a(),P(q,{key:s(w).selectedCompanyCurrency,modelValue:s(B),"onUpdate:modelValue":S[2]||(S[2]=l=>F(B)?B.value=l:null),currency:s(w).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"]))]),_:1},8,["label"]),r(O,{label:x.$t("items.unit")},{default:d(()=>[r(U,{modelValue:s(f).currentItem.unit_id,"onUpdate:modelValue":S[3]||(S[3]=l=>s(f).currentItem.unit_id=l),label:"name",options:s(f).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:x.$t("items.select_a_unit"),searchable:"","track-by":"id"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),s(k)?(a(),P(O,{key:0,label:x.$t("items.taxes")},{default:d(()=>[r(U,{modelValue:s(T),"onUpdate:modelValue":S[4]||(S[4]=l=>F(T)?T.value=l:null),options:s(u),label:"name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"id",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):D("",!0),r(O,{label:x.$t("items.description"),error:s(g).description.$error&&s(g).description.$errors[0].$message},{default:d(()=>[r(Q,{modelValue:s(f).currentItem.description,"onUpdate:modelValue":S[5]||(S[5]=l=>s(f).currentItem.description=l),rows:"4",cols:"50",invalid:s(g).description.$error,onInput:S[6]||(S[6]=l=>s(g).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),o("div",Go,[r(E,{class:"mr-3",variant:"primary-outline",type:"button",onClick:M},{default:d(()=>[j(y(x.$t("general.cancel")),1)]),_:1}),r(E,{loading:m.value,disabled:m.value,variant:"primary",type:"submit"},{left:d(l=>[r(v,{name:"SaveIcon",class:Y(l.class)},null,8,["class"])]),default:d(()=>[j(" "+y(s(f).isEdit?x.$t("general.update"):x.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,Yo)])]),_:1},8,["show"])}}};export{tn as _,on as a,Qo as b,en as c,Zo as d};
