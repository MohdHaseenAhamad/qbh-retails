import{V as D,r as o,o as f,c as F,a,w as s,m as t,H as J,a1 as Q,e as W,g as G,x as X,f as Y,l as S,h as _,i as v,a4 as Z,a5 as x,aP as ee,k as te,K as ae,b as V,n as y,t as h,U as q,E as M,q as U,s as ne,aa as ie}from"./main.d0ffa6eb.js";import{_ as se,a as oe,b as le,c as re,d as de}from"./ItemModal.720790e2.js";import{_ as me}from"./SelectTemplateButton.5704c8fd.js";import{_ as ue}from"./CreateCustomFields.e1e8603d.js";import{_ as ce}from"./ExchangeRateConverter.ef383681.js";import{_ as ge}from"./TaxTypeModal.fd62b2ec.js";import{_ as pe}from"./PreparedByModal.fa78cd8f.js";import{_ as _e}from"./BankDetailModal.ae909e8c.js";import"./DragIcon.e0a4ab5f.js";import"./ItemUnitModal.dc6156ec.js";import"./SelectNotePopup.f61bb6cc.js";import"./NoteModal.688693f3.js";/* empty css                                                  *//* empty css                                                                      */const fe={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},be={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(i){const e=D();function k(n){e.newEstimate.prepared_by_id=n}function C(n){e.newEstimate.bank_detail_id=n}return(n,l)=>{const m=o("BaseCustomerSelectPopup"),u=o("BaseInputGroup"),E=o("BaseDatePicker"),b=o("BaseInput"),c=o("BasePreparedBySelect"),I=o("BaseBankDetailSelect"),p=o("BaseInputGrid");return f(),F("div",fe,[a(p,{class:"col-span-12 sm:grid-cols-4 md:grid-cols-4"},{default:s(()=>[a(u,{label:n.$t("invoices.client"),"content-loading":i.isLoading,required:""},{default:s(()=>[a(m,{modelValue:t(e).newEstimate.customer,"onUpdate:modelValue":l[0]||(l[0]=d=>t(e).newEstimate.customer=d),valid:i.v.customer_id,"content-loading":i.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"])]),_:1},8,["label","content-loading"]),a(u,{label:n.$t("reports.estimates.estimate_date"),"content-loading":i.isLoading,required:"",error:i.v.estimate_date.$error&&i.v.estimate_date.$errors[0].$message},{default:s(()=>[a(E,{modelValue:t(e).newEstimate.estimate_date,"onUpdate:modelValue":l[1]||(l[1]=d=>t(e).newEstimate.estimate_date=d),"content-loading":i.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(u,{label:n.$t("estimates.expiry_date"),"content-loading":i.isLoading,required:"",error:i.v.expiry_date.$error&&i.v.expiry_date.$errors[0].$message},{default:s(()=>[a(E,{modelValue:t(e).newEstimate.expiry_date,"onUpdate:modelValue":l[2]||(l[2]=d=>t(e).newEstimate.expiry_date=d),"content-loading":i.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(u,{label:n.$t("estimates.estimate_number"),"content-loading":i.isLoading,required:"",error:i.v.estimate_number.$error&&i.v.estimate_number.$errors[0].$message},{default:s(()=>[a(b,{modelValue:t(e).newEstimate.estimate_number,"onUpdate:modelValue":l[3]||(l[3]=d=>t(e).newEstimate.estimate_number=d),"content-loading":i.isLoading,disabled:""},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(u,{label:n.$t("estimates.prepared_by"),"content-loading":i.isLoading},{default:s(()=>[a(c,{type:"Estimate","store-prop":n.newInvoice,store:t(e),"content-loading":i.isLoading,onSelect:k,item:t(e).newEstimate.prepared_by_id},null,8,["store-prop","store","content-loading","item"])]),_:1},8,["label","content-loading"]),a(u,{label:n.$t("invoices.bank_Detail"),"content-loading":i.isLoading},{default:s(()=>[a(I,{type:"Estimate","store-prop":n.newEstimate,store:t(e),"content-loading":i.isLoading,onSelect:C,item:t(e).newEstimate.bank_detail_id},null,8,["store-prop","store","content-loading","item"])]),_:1},8,["label","content-loading"]),a(u,{label:n.$t("estimates.upper_margin"),"content-loading":n.isLoadingContent},{default:s(()=>[a(b,{modelValue:t(e).newEstimate.upper_margin,"onUpdate:modelValue":l[4]||(l[4]=d=>t(e).newEstimate.upper_margin=d),"content-loading":n.isLoadingContent},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(u,{label:n.$t("estimates.lower_margin"),"content-loading":n.isLoadingContent},{default:s(()=>[a(b,{modelValue:t(e).newEstimate.lower_margin,"onUpdate:modelValue":l[5]||(l[5]=d=>t(e).newEstimate.lower_margin=d),"content-loading":n.isLoadingContent},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(ce,{store:t(e),"store-prop":"newEstimate",v:i.v,"is-loading":i.isLoading,"is-edit":i.isEdit,"customer-currency":t(e).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},we=["onSubmit"],ve={class:"flex"},ye={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},Ee={class:"relative w-full lg:w-1/2"},De={setup(i){const e=D(),k=J(),C=Q(),{t:n}=W(),l="newEstimate";let m=G(!1);const u=G(["customer","company","customerCustom","estimate","estimateCustom"]);let E=X(),b=Y(),c=S(()=>e.isFetchingInitialSettings),I=S(()=>p.value?n("estimates.edit_estimate"):n("estimates.new_estimate")),p=S(()=>E.name==="estimates.edit");const d={estimate_date:{required:_.withMessage(n("validation.required"),v)},expiry_date:{required:_.withMessage(n("validation.required"),v)},estimate_number:{required:_.withMessage(n("validation.required"),v)},reference_number:{maxLength:_.withMessage(n("validation.price_maxlength"),Z(255))},customer_id:{required:_.withMessage(n("validation.required"),v)},exchange_rate:{required:x(function(){return _.withMessage(n("validation.required"),v),e.showExchangeRate}),decimal:_.withMessage(n("validation.valid_exchange_rate"),ee)}},B=te(d,S(()=>e.newEstimate),{$scope:l});ae(()=>e.newEstimate.customer,r=>{r&&r.currency?e.newEstimate.selectedCurrency=r.currency:e.newEstimate.selectedCurrency=k.selectedCompanyCurrency}),e.resetCurrentEstimate(),C.resetCustomFields(),B.value.$reset,e.fetchEstimateInitialSettings(p.value);async function T(){if(B.value.$touch(),B.value.$invalid)return!1;m.value=!0;let r={...e.newEstimate,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax,prepared_by_id:e.newEstimate.prepared_by_id?e.newEstimate.prepared_by_id.id:"",bank_detail_id:e.newEstimate.bank_detail_id?e.newEstimate.bank_detail_id.id:""};const $=p.value?e.updateEstimate:e.addEstimate;try{let g=await $(r);g.data.data&&b.push(`/admin/estimates/${g.data.data.id}/view`)}catch(g){console.error(g)}m.value=!1}return(r,$)=>{const g=o("BaseBreadcrumbItem"),j=o("BaseBreadcrumb"),L=o("BaseButton"),N=o("router-link"),P=o("BaseIcon"),H=o("BasePageHeader"),R=o("BaseInput"),z=o("BaseInputGroup"),K=o("BaseInputGrid"),O=o("BaseScrollPane"),A=o("BasePage");return f(),F(ie,null,[a(se),a(oe),a(pe),a(_e),a(ge),a(A,{class:"relative estimate-create-page"},{default:s(()=>[V("form",{onSubmit:ne(T,["prevent"])},[a(H,{title:t(I)},{actions:s(()=>[r.$route.name==="estimates.edit"?(f(),y(N,{key:0,to:`/estimates/pdf/${t(e).newEstimate.unique_hash}`,target:"_blank"},{default:s(()=>[a(L,{class:"mr-3",variant:"primary-outline",type:"button"},{default:s(()=>[V("span",ve,h(r.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):q("",!0),a(L,{loading:t(m),disabled:t(m),"content-loading":t(c),variant:"primary",type:"submit"},{left:s(w=>[t(m)?q("",!0):(f(),y(P,{key:0,class:M(w.class),name:"SaveIcon"},null,8,["class"]))]),default:s(()=>[U(" "+h(r.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:s(()=>[a(j,null,{default:s(()=>[a(g,{title:r.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),a(g,{title:r.$tc("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),r.$route.name==="estimates.edit"?(f(),y(g,{key:0,title:r.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(f(),y(g,{key:1,title:r.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),a(be,{v:t(B),"is-loading":t(c),"is-edit":t(p)},null,8,["v","is-loading","is-edit"]),a(O,null,{default:s(()=>[a(le,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(c),"item-validation-scope":l,store:t(e),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),V("div",ye,[V("div",Ee,[a(re,{store:t(e),"store-prop":"newEstimate",fields:u.value,type:"Estimate"},null,8,["store","fields"])]),a(de,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(c),store:t(e),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])]),a(K,{class:"sm:grid-cols-4 md:grid-cols-4 col-span-12 mb-4"},{default:s(()=>[a(ue,{type:"Estimate","is-edit":t(p),"is-loading":t(c),store:t(e),"store-prop":"newEstimate","custom-field-scope":l,class:"mb-6"},null,8,["is-edit","is-loading","store"]),a(z,{label:r.$t("estimates.subject"),"content-loading":t(c)},{default:s(()=>[a(R,{modelValue:t(e).newEstimate.subject,"onUpdate:modelValue":$[0]||($[0]=w=>t(e).newEstimate.subject=w),"content-loading":t(c)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(me,{store:t(e),"component-name":"EstimateTemplate","store-prop":"newEstimate"},null,8,["store"])]),_:1}),a(L,{loading:t(m),disabled:t(m),"content-loading":t(c),variant:"primary",type:"submit"},{left:s(w=>[t(m)?q("",!0):(f(),y(P,{key:0,class:M(w.class),name:"SaveIcon"},null,8,["class"]))]),default:s(()=>[U(" "+h(r.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),_:1})],40,we)]),_:1})],64)}}};export{De as default};
