import{Q as Y,ar as Z,u as ee,I as ae,R as te,e as oe,F as re,g as c,x as se,f as le,y as ne,l as g,K as de,ab as ie,r as d,o as i,c as h,a as t,n as p,w as s,m as r,J as C,q as S,t as y,U as _,b as u,aa as N,a9 as ue,E as ce}from"./main.d0ffa6eb.js";import{_ as me,a as fe}from"./SendProformaModal.4c1f0c1c.js";import{L as pe}from"./LoadingIcon.272413e7.js";const _e={class:"fixed top-0 left-0 hidden h-full pt-16 pb-4 ml-56 bg-white xl:ml-64 w-88 xl:block"},ye={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},be={class:"mb-6"},ge={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},he={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},ve={key:0,class:"h-full pb-32 overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},xe={class:"flex-2"},Be={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},Ee={class:"flex-1 whitespace-nowrap right"},we={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},ke={class:"flex justify-center p-4 items-center"},Ie={key:0,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Se={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},Te=["src"],Pe={setup(Ve){const R=Y(),m=Z();ee();const T=ae();te();const{t:E}=oe();re("$utils"),c(null),c(null);const n=c(null);c(null);const v=se();le(),c(["DRAFT","SENT","VIEWED","EXPIRED","ACCEPTED","REJECTED"]),c(!1);const A=c(!1);c(!1);const V=c(!1),b=c(!1),a=ne({orderBy:null,orderByField:null,searchText:null}),U=g(()=>n.value.proforma_number),$=g(()=>a.orderBy==="asc"||a.orderBy==null);g(()=>$.value?E("general.ascending"):E("general.descending"));const z=g(()=>`/proformas/pdf/${n.value.unique_hash}`);g(()=>n.value&&n.value.id?proforma.value.id:null),de(v,(e,l)=>{e.name==="proformas.view"&&F()});async function L(e){R.openModal({title:E("proformas.send_proforma"),componentName:"SendProformaModal",id:n.value.id,data:n.value})}function M(e){return v.params.id==e}async function D(){b.value=!0,await m.fetchProformas(),b.value=!1,setTimeout(()=>{j()},500)}function j(){const e=document.getElementById(`proforma-${v.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"))}async function F(){let e=await m.fetchProforma(v.params.id);e.data&&(n.value={...e.data.data})}async function f(){let e="";a.searchText!==""&&a.searchText!==null&&a.searchText!==void 0&&(e+=`search=${a.searchText}&`),a.orderBy!==null&&a.orderBy!==void 0&&(e+=`orderBy=${a.orderBy}&`),a.orderByField!==null&&a.orderByField!==void 0&&(e+=`orderByField=${a.orderByField}`),V.value=!0;let l=await m.searchProforma(e);V.value=!1,l.data&&(m.proformas=l.data.data)}function O(){return a.orderBy==="asc"?(a.orderBy="desc",f(),!0):(a.orderBy="asc",f(),!0)}return D(),F(),f=ie.exports.debounce(f,500),(e,l)=>{const x=d("BaseButton"),P=d("router-link"),q=d("BasePageHeader"),B=d("BaseIcon"),G=d("BaseInput"),w=d("BaseRadio"),k=d("BaseInputGroup"),I=d("BaseDropdownItem"),H=d("BaseDropdown"),J=d("BaseText"),W=d("BaseEstimateStatusBadge"),K=d("BaseFormatMoney"),Q=d("BasePage");return i(),h(N,null,[t(me),n.value?(i(),p(Q,{key:0,class:"xl:pl-96 xl:ml-8"},{default:s(()=>[t(q,{title:r(U)},{actions:s(()=>[n.value.status==="DRAFT"&&r(T).hasAbilities(r(C).SEND_INVOICE)?(i(),p(x,{key:0,disabled:A.value,variant:"primary",class:"text-sm",onClick:L},{default:s(()=>[S(y(e.$t("proformas.send_proforma")),1)]),_:1},8,["disabled"])):_("",!0),r(T).hasAbilities(r(C).CREATE_PAYMENT)?(i(),p(P,{key:1,to:`/admin/payments/${e.$route.params.id}/create`},{default:s(()=>[n.value.status==="SENT"||n.value.status==="OVERDUE"||n.value.status==="VIEWED"?(i(),p(x,{key:0,variant:"primary"},{default:s(()=>[S(y(e.$t("proformas.record_payment")),1)]),_:1})):_("",!0)]),_:1},8,["to"])):_("",!0),t(fe,{class:"ml-3",row:n.value,"load-data":D},null,8,["row"])]),_:1},8,["title"]),u("div",_e,[u("div",ye,[u("div",be,[t(G,{modelValue:r(a).searchText,"onUpdate:modelValue":l[0]||(l[0]=o=>r(a).searchText=o),placeholder:e.$t("general.search"),type:"text",variant:"gray",onInput:l[1]||(l[1]=o=>f())},{right:s(()=>[t(B,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),u("div",ge,[t(H,{class:"ml-3",position:"bottom-start"},{activator:s(()=>[t(x,{size:"md",variant:"gray"},{default:s(()=>[t(B,{name:"FilterIcon"})]),_:1})]),default:s(()=>[u("div",he,y(e.$t("general.sort_by")),1),t(I,{class:"flex px-1 py-2 cursor-pointer"},{default:s(()=>[t(k,{class:"-mt-3 font-normal"},{default:s(()=>[t(w,{id:"filter_proforma_date",modelValue:r(a).orderByField,"onUpdate:modelValue":[l[2]||(l[2]=o=>r(a).orderByField=o),f],label:e.$t("reports.proformas.proforma_date"),size:"sm",name:"filter",value:"proforma_date"},null,8,["modelValue","label"])]),_:1})]),_:1}),t(I,{class:"flex px-1 py-2 cursor-pointer"},{default:s(()=>[t(k,{class:"-mt-3 font-normal"},{default:s(()=>[t(w,{id:"filter_due_date",modelValue:r(a).orderByField,"onUpdate:modelValue":[l[3]||(l[3]=o=>r(a).orderByField=o),f],label:e.$t("proformas.due_date"),value:"due_date",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1}),t(I,{class:"flex px-1 py-2 cursor-pointer"},{default:s(()=>[t(k,{class:"-mt-3 font-normal"},{default:s(()=>[t(w,{id:"filter_proforma_number",modelValue:r(a).orderByField,"onUpdate:modelValue":[l[4]||(l[4]=o=>r(a).orderByField=o),f],label:e.$t("proformas.proforma_number"),value:"proforma_number",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),t(x,{class:"ml-1",size:"md",variant:"gray",onClick:O},{default:s(()=>[r($)?(i(),p(B,{key:0,name:"SortAscendingIcon"})):(i(),p(B,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),r(m)&&r(m).proformas?(i(),h("div",ve,[(i(!0),h(N,null,ue(r(m).proformas,(o,X)=>(i(),h("div",{key:X},[o&&!b.value?(i(),p(P,{key:0,id:"proforma-"+o.id,to:`/admin/proformas/${o.id}/view`,class:ce(["flex justify-between side-proforma p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":M(o.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:s(()=>[u("div",xe,[t(J,{text:o.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),u("div",Be,y(o.proforma_number),1),t(W,{status:o.status,class:"px-1 text-xs"},{default:s(()=>[S(y(o.status),1)]),_:2},1032,["status"])]),u("div",Ee,[t(K,{class:"mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900 block",amount:o.total,currency:o.customer.currency},null,8,["amount","currency"]),u("div",we,y(o.formatted_proforma_date),1)])]),_:2},1032,["id","to","class"])):_("",!0)]))),128)),u("div",ke,[b.value?(i(),p(pe,{key:0,class:"h-6 m-1 animate-spin text-primary-400"})):_("",!0)]),!r(m).proformas.length&&!b.value?(i(),h("p",Ie,y(e.$t("proformas.no_matching_proformas")),1)):_("",!0)])):_("",!0)]),u("div",Se,[u("iframe",{src:`${r(z)}`,class:"flex-1 border border-gray-400 border-solid bg-white rounded-md frame-style"},null,8,Te)])]),_:1})):_("",!0)],64)}}};export{Pe as default};
