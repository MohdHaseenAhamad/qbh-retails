import{an as ee,av as te,Q as ne,H as ae,e as oe,x as le,f as se,I as re,a3 as ie,g as V,l as c,h as S,i as me,z as ue,a4 as ce,k as de,J as pe,r as i,o as h,n as w,w as r,a,m as e,b as U,p as k,q as P,t as E,U as N,E as ge,s as _e}from"./main.d0ffa6eb.js";import{_ as Ie}from"./ItemUnitModal.dc6156ec.js";const fe=["onSubmit"],ye={setup(ve){const n=ee(),T=te(),v=ne(),q=ae(),{t:d}=oe(),B=le(),z=se(),A=re(),M=ie(),g=V(!1),b=V(q.selectedCompanySettings.tax_per_item);let l=V(!1);n.$reset(),R();const _=c({get:()=>n.currentItem.price/100,set:t=>{n.currentItem.price=Math.round(t*100)}}),y=c({get:()=>n?.currentItem?.taxes?.map(t=>{if(t)return{...t,tax_type_id:t.id,tax_name:t.name+" ("+t.percent+"%)"}})[0],set:t=>{n.currentItem.taxes=[t]}}),I=c(()=>B.name==="items.edit"),x=c(()=>I.value?d("items.edit_item"):d("items.new_item")),G=c(()=>T.taxTypes.map(t=>({...t,tax_type_id:t.id,tax_name:t.name_ar+"/"+t.name+" ("+t.percent+"%)"}))),L=c(()=>b.value==="YES"),D=c(()=>({currentItem:{name:{required:S.withMessage(d("validation.required"),me),minLength:S.withMessage(d("validation.name_min_length",{count:3}),ue(3))},description:{maxLength:S.withMessage(d("validation.description_maxlength"),ce(65e3))}}})),m=de(D,n);async function H(){v.openModal({title:d("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}async function R(){if(l.value=!0,await M.fetchCategories({type:"item",name_with_code:!0}),await n.fetchItemUnits({limit:"all"}),A.hasAbilities(pe.VIEW_TAX_TYPE)&&await T.fetchTaxTypes({limit:"all"}),I.value){let t=B.params.id;await n.fetchItem(t),n.currentItem.tax_per_item===1?b.value="YES":b.value="NO"}l.value=!1}async function Y(){if(m.value.currentItem.$touch(),m.value.currentItem.$invalid)return!1;g.value=!0;try{let o={id:B.params.id,...n.currentItem};n.currentItem&&n.currentItem.taxes&&(o.taxes=n.currentItem.taxes.map(u=>({tax_type_id:u.tax_type_id,amount:_.value*u.percent,percent:u.percent,name:u.name,name_ar:u.name_ar,collective_tax:0}))),await(I.value?n.updateItem:n.addItem)(o),g.value=!1,z.push("/admin/items"),t()}catch{g.value=!1;return}function t(){v.closeModal(),setTimeout(()=>{n.resetCurrentItem(),v.$reset(),m.value.$reset()},300)}}return(t,o)=>{const f=i("BaseBreadcrumbItem"),u=i("BaseBreadcrumb"),j=i("BasePageHeader"),F=i("BaseInput"),p=i("BaseInputGroup"),$=i("BaseMultiselect"),J=i("BaseMoney"),C=i("BaseIcon"),O=i("BaseSelectAction"),Q=i("BaseTextarea"),W=i("BaseButton"),X=i("BaseInputGrid"),K=i("BaseCard"),Z=i("BasePage");return h(),w(Z,null,{default:r(()=>[a(j,{title:e(x)},{default:r(()=>[a(u,null,{default:r(()=>[a(f,{title:t.$t("general.home"),to:"dashboard"},null,8,["title"]),a(f,{title:t.$tc("items.item",2),to:"/admin/items"},null,8,["title"]),a(f,{title:e(x),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),a(Ie),U("form",{class:"grid lg:grid-cols-2 mt-6",action:"submit",onSubmit:_e(Y,["prevent"])},[a(K,{class:"w-full"},{default:r(()=>[a(X,{layout:"one-column"},{default:r(()=>[a(p,{label:t.$t("items.name"),"content-loading":e(l),required:"",error:e(m).currentItem.name.$error&&e(m).currentItem.name.$errors[0].$message},{default:r(()=>[a(F,{modelValue:e(n).currentItem.name,"onUpdate:modelValue":o[0]||(o[0]=s=>e(n).currentItem.name=s),"content-loading":e(l),invalid:e(m).currentItem.name.$error,onInput:o[1]||(o[1]=s=>e(m).currentItem.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),a(p,{label:t.$t("categories.name"),"content-loading":e(l)},{default:r(()=>[a($,{modelValue:e(n).currentItem.category_id,"onUpdate:modelValue":o[2]||(o[2]=s=>e(n).currentItem.category_id=s),"value-prop":"id",label:"name","track-by":"name","content-loading":e(l),options:e(M).categories,searchable:"","can-deselect":!1,placeholder:t.$t("categories.select"),class:"w-full"},null,8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["label","content-loading"]),a(p,{label:t.$t("items.price"),"content-loading":e(l)},{default:r(()=>[a(J,{modelValue:e(_),"onUpdate:modelValue":o[3]||(o[3]=s=>k(_)?_.value=s:null),"content-loading":e(l)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(p,{"content-loading":e(l),label:t.$t("items.unit")},{default:r(()=>[a($,{modelValue:e(n).currentItem.unit_id,"onUpdate:modelValue":o[4]||(o[4]=s=>e(n).currentItem.unit_id=s),"content-loading":e(l),label:"name",options:e(n).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:t.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:r(()=>[a(O,{onClick:H},{default:r(()=>[a(C,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),P(" "+E(t.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),e(L)?(h(),w(p,{key:0,label:t.$t("items.taxes"),"content-loading":e(l)},{default:r(()=>[a($,{modelValue:e(y),"onUpdate:modelValue":o[5]||(o[5]=s=>k(y)?y.value=s:null),"content-loading":e(l),options:e(G),mode:"single",label:"tax_name",class:"w-full","value-prop":"id",searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"])):N("",!0),a(p,{label:t.$t("items.description"),"content-loading":e(l),error:e(m).currentItem.description.$error&&e(m).currentItem.description.$errors[0].$message},{default:r(()=>[a(Q,{modelValue:e(n).currentItem.description,"onUpdate:modelValue":o[6]||(o[6]=s=>e(n).currentItem.description=s),"content-loading":e(l),name:"description",row:2,rows:"2",onInput:o[7]||(o[7]=s=>e(m).currentItem.description.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),U("div",null,[a(W,{"content-loading":e(l),type:"submit",loading:g.value},{left:r(s=>[g.value?N("",!0):(h(),w(C,{key:0,name:"SaveIcon",class:ge(s.class)},null,8,["class"]))]),default:r(()=>[P(" "+E(e(I)?t.$t("items.update_item"):t.$t("items.save_item")),1)]),_:1},8,["content-loading","loading"])])]),_:1})]),_:1})],40,fe)]),_:1})}}};export{ye as default};
