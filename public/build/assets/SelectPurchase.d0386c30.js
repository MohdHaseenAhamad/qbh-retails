import{x as T,f as K,am as O,u as Q,ac as z,a1 as J,H as W,Q as X,al as Y,a2 as Z,F as ee,e as te,g as b,y as ae,l as f,h as I,i as q,k as ne,O as oe,aK as re,r as u,o as ue,c as se,a as n,w as l,b as v,m as a,t as B,q as ie,s as le,aa as ce}from"./main.d0ffa6eb.js";/* empty css                                                  *//* empty css                                                                      */import{_ as me}from"./PaymentModeModal.72b41f55.js";const de=["onSubmit"],pe=v("h3",null,"Please select supplier and purchase voucher to generate debit note",-1),ye=v("br",null,null,-1),_e=v("br",null,null,-1),fe={class:"absolute left-3.5"},Be={setup(ve){const r=T(),w=K(),e=O();Q();const V=z();J(),W(),X();const S=Y();Z();const M=ee("utils"),{t:P}=te();let $=b(!1),h=b(!1),c=b([]);const g=b(null),N="newEstimate";ae(["customer","company","customerCustom","payment","paymentCustom"]),f({get:()=>e.currentPayment.amount/100,set:t=>{e.currentPayment.amount=Math.round(t*100)}});const y=f(()=>e.isFetchingInitialData),m=f(()=>r.name==="payments.edit"),D="purchase";f(()=>m.value?P("payments.edit_payment"):P("payments.new_payment"));const E=f(()=>({currentPayment:{customer_id:{required:I.withMessage(P("validation.required"),q)},invoice_id:{required:I.withMessage(P("validation.required"),q)}}})),_=ne(E,e,{$scope:N});oe(()=>{e.currentPayment.customer_id&&U(e.currentPayment.customer_id),r.query.customer&&(e.currentPayment.customer_id=r.query.customer)}),e.resetCurrentPayment(),r.query.customer&&(e.currentPayment.customer_id=r.query.customer),e.fetchPaymentInitialData(m.value),r.params.id&&!m.value&&F();async function F(){let t=await S.fetchInvoice(r?.params?.id);e.currentPayment.customer_id=t.data.data.customer.id,e.currentPayment.invoice_id=t.data.data.id}async function k(t){}function U(t){if(t){let o={supplier_id:t,limit:"all"};m.value&&(o.status=""),h.value=!0,Promise.all([S.fetchPurchases(o,!0),V.fetchSupplier(t)]).then(async([s,d])=>{s&&(c.value=[...s.data.data]),d&&d.data&&(e.currentPayment.selectedCustomer=d.data.data,e.currentPayment.customer=d.data.data,e.currentPayment.currency=d.data.data.currency),m.value&&e.currentPayment.invoice_id&&(g.value=c.value.find(p=>p.id===e.currentPayment.invoice_id),e.currentPayment.maxPayableAmount=g.value.due_amount+e.currentPayment.amount),m.value&&(alert("isEdit.value"),c.value=c.value.filter(p=>p.due_amount>0||p.id==e.currentPayment.invoice_id)),h.value=!1}).catch(s=>{h.value=!1,console.error(s,"error")})}}re(()=>{e.resetCurrentPayment(),c.value=[]});async function A(){if(_.value.$touch(),_.value.$invalid)return!1;$.value=!0,w.push(`/admin/debit-note/${e.currentPayment.invoice_id}/create`)}function G(t){let o={userId:t};r.params.id&&(o.model_id=r.params.id),e.currentPayment.invoice_id=g.value=null,e.currentPayment.amount=100,c.value=[],e.getNextNumber(o,!0)}return(t,o)=>{const s=u("BaseBreadcrumbItem"),d=u("BaseBreadcrumb"),p=u("BasePageHeader"),H=u("BaseCustomerSelectInput"),C=u("BaseInputGroup"),L=u("BaseMultiselect"),j=u("BaseButton"),x=u("BaseCard"),R=u("BasePage");return ue(),se(ce,null,[n(me),n(R,{class:"relative payment-create"},{default:l(()=>[v("form",{action:"",onSubmit:le(A,["prevent"])},[n(p,{title:t.$t("debitnote.title")},{default:l(()=>[n(d,null,{default:l(()=>[n(s,{title:t.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),n(s,{title:t.$t("debitnote.title"),to:"/admin/debit-note"},null,8,["title"]),n(s,{title:t.$t("debitnote.new"),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),n(x,null,{default:l(()=>[pe,ye,n(C,{label:t.$t("purchases.supplier"),error:a(_).currentPayment.customer_id.$error&&a(_).currentPayment.customer_id.$errors[0].$message,"content-loading":a(y),required:""},{default:l(()=>[n(H,{modelValue:a(e).currentPayment.customer_id,"onUpdate:modelValue":[o[0]||(o[0]=i=>a(e).currentPayment.customer_id=i),o[1]||(o[1]=i=>G(a(e).currentPayment.customer_id))],"content-loading":a(y),invalid:a(_).currentPayment.customer_id.$error,placeholder:t.$t("customers.select_a_customer"),"fetch-all":a(m),"customer-type":D,"show-action":""},null,8,["modelValue","content-loading","invalid","placeholder","fetch-all"])]),_:1},8,["label","error","content-loading"]),_e,n(C,{required:"","content-loading":a(y),label:t.$t("pdf_label_purchase_voucher"),"help-text":g.value?`Due Amount: ${a(e).currentPayment.maxPayableAmount/100}`:""},{default:l(()=>[n(L,{modelValue:a(e).currentPayment.invoice_id,"onUpdate:modelValue":o[2]||(o[2]=i=>a(e).currentPayment.invoice_id=i),"content-loading":a(y),"value-prop":"id","track-by":"purchase_no",label:"purchase_no",options:a(c),loading:a(h),placeholder:t.$t("invoices.select_invoice"),onSelect:k},{singlelabel:l(({value:i})=>[v("div",fe,B(i.purchase_no)+" ("+B(a(M).formatMoney(i.total,i.supplier.currency))+") ",1)]),_:1},8,["modelValue","content-loading","options","loading","placeholder"])]),_:1},8,["content-loading","label","help-text"]),n(j,{loading:a($),"content-loading":a(y),variant:"primary",type:"submit",class:"flex justify-center mt-4"},{default:l(()=>[ie(B(t.$t("debitnote.proceed")),1)]),_:1},8,["loading","content-loading"])]),_:1})],40,de)]),_:1})],64)}}};export{Be as default};
