import{x as N,aY as E,a2 as K,g as C,y as Y,l as q,K as P,M as J,r as g,o as p,c as x,b as m,a as t,m as e,t as F,w as d,n as $,U as h,aa as O,aj as Q,H as W,a1 as X,e as Z,f as ee,h as f,i as b,a5 as D,aP as ne,k as te,E as ie,q as re,s as ae}from"./main.d0ffa6eb.js";import{_ as oe,a as le,b as se,c as ce,d as ue}from"./ItemModal.720790e2.js";import{_ as de}from"./SelectTemplateButton.5704c8fd.js";import{_ as ve}from"./ExchangeRateConverter.ef383681.js";import{_ as ge}from"./CreateCustomFields.e1e8603d.js";import{_ as me}from"./TaxTypeModal.fd62b2ec.js";import"./DragIcon.e0a4ab5f.js";import"./ItemUnitModal.dc6156ec.js";import"./SelectNotePopup.f61bb6cc.js";import"./NoteModal.688693f3.js";/* empty css                                                  *//* empty css                                                                      */const fe={class:"col-span-5 pr-0"},_e={class:"flex mt-7"},ye={class:"relative w-20 mt-8"},pe={class:"ml-2"},Ie={class:"p-0 mb-1 leading-snug text-left text-black"},be={class:"p-0 m-0 text-xs leading-tight text-left text-gray-500",style:{"max-width":"480px"}},$e={class:"grid grid-cols-1 col-span-7 gap-4 mt-8 lg:gap-6 lg:mt-0 lg:grid-cols-2"},we={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(a){const o=a,k=N(),n=E(),w=K(),i=C(!1),v=C(!1),U=Y([{label:"None",value:"NONE"},{label:"Date",value:"DATE"},{label:"Count",value:"COUNT"}]),R=q(()=>n.newRecurringInvoice.selectedFrequency&&n.newRecurringInvoice.selectedFrequency.value==="CUSTOM"),V=q(()=>o.isEdit?w.config.recurring_invoice_status.update_status:w.config.recurring_invoice_status.create_status);P(()=>n.newRecurringInvoice.selectedFrequency,s=>{n.isFetchingInitialSettings||(s&&s.value!=="CUSTOM"?n.newRecurringInvoice.frequency=s.value:n.newRecurringInvoice.frequency=null)}),J(()=>{k.params.id||y()});function _(s){return n.newRecurringInvoice.limit_by===s}const M=Q(()=>{y()},500);async function y(){const s=n.newRecurringInvoice.frequency;if(!s)return;v.value=!0;let r={starts_at:n.newRecurringInvoice.starts_at,frequency:s};try{await n.fetchRecurringInvoiceFrequencyDate(r)}catch(B){console.error(B),v.value=!1}v.value=!1}return(s,r)=>{const B=g("BaseCustomerSelectPopup"),T=g("BaseSwitch"),c=g("BaseDatePicker"),u=g("BaseInputGroup"),I=g("BaseMultiselect"),S=g("BaseInput");return p(),x(O,null,[m("div",fe,[t(B,{modelValue:e(n).newRecurringInvoice.customer,"onUpdate:modelValue":r[0]||(r[0]=l=>e(n).newRecurringInvoice.customer=l),valid:a.v.customer_id,"content-loading":i.value,type:"recurring-invoice"},null,8,["modelValue","valid","content-loading"]),m("div",_e,[m("div",ye,[t(T,{modelValue:e(n).newRecurringInvoice.send_automatically,"onUpdate:modelValue":r[1]||(r[1]=l=>e(n).newRecurringInvoice.send_automatically=l),class:"absolute -top-4"},null,8,["modelValue"])]),m("div",pe,[m("p",Ie,F(s.$t("recurring_invoices.send_automatically")),1),m("p",be,F(s.$t("recurring_invoices.send_automatically_desc")),1)])])]),m("div",$e,[t(u,{label:s.$t("recurring_invoices.starts_at"),"content-loading":i.value,required:"",error:a.v.starts_at.$error&&a.v.starts_at.$errors[0].$message},{default:d(()=>[t(c,{modelValue:e(n).newRecurringInvoice.starts_at,"onUpdate:modelValue":r[2]||(r[2]=l=>e(n).newRecurringInvoice.starts_at=l),"content-loading":i.value,"calendar-button":!0,"calendar-button-icon":"calendar",invalid:a.v.starts_at.$error,onChange:r[3]||(r[3]=l=>y())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),t(u,{label:s.$t("recurring_invoices.next_invoice_date"),"content-loading":i.value,required:""},{default:d(()=>[t(c,{modelValue:e(n).newRecurringInvoice.next_invoice_at,"onUpdate:modelValue":r[4]||(r[4]=l=>e(n).newRecurringInvoice.next_invoice_at=l),"content-loading":i.value,"calendar-button":!0,disabled:!0,loading:v.value,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","loading"])]),_:1},8,["label","content-loading"]),t(u,{label:s.$t("recurring_invoices.limit_by"),"content-loading":i.value,class:"lg:mt-0",required:"",error:a.v.limit_by.$error&&a.v.limit_by.$errors[0].$message},{default:d(()=>[t(I,{modelValue:e(n).newRecurringInvoice.limit_by,"onUpdate:modelValue":r[5]||(r[5]=l=>e(n).newRecurringInvoice.limit_by=l),"content-loading":i.value,options:e(U),label:"label",invalid:a.v.limit_by.$error,"value-prop":"value"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),_("DATE")?(p(),$(u,{key:0,label:s.$t("recurring_invoices.limit_date"),"content-loading":i.value,required:_("DATE"),error:a.v.limit_date.$error&&a.v.limit_date.$errors[0].$message},{default:d(()=>[t(c,{modelValue:e(n).newRecurringInvoice.limit_date,"onUpdate:modelValue":r[6]||(r[6]=l=>e(n).newRecurringInvoice.limit_date=l),"content-loading":i.value,invalid:a.v.limit_date.$error,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):h("",!0),_("COUNT")?(p(),$(u,{key:1,label:s.$t("recurring_invoices.count"),"content-loading":i.value,required:_("COUNT"),error:a.v.limit_count.$error&&a.v.limit_count.$errors[0].$message},{default:d(()=>[t(S,{modelValue:e(n).newRecurringInvoice.limit_count,"onUpdate:modelValue":r[7]||(r[7]=l=>e(n).newRecurringInvoice.limit_count=l),"content-loading":i.value,invalid:a.v.limit_count.$error,type:"number"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):h("",!0),t(u,{label:s.$t("recurring_invoices.status"),required:"","content-loading":i.value,error:a.v.status.$error&&a.v.status.$errors[0].$message},{default:d(()=>[t(I,{modelValue:e(n).newRecurringInvoice.status,"onUpdate:modelValue":r[8]||(r[8]=l=>e(n).newRecurringInvoice.status=l),options:e(V),"content-loading":i.value,invalid:a.v.status.$error,placeholder:s.$t("recurring_invoices.select_a_status"),"value-prop":"value",label:"value"},null,8,["modelValue","options","content-loading","invalid","placeholder"])]),_:1},8,["label","content-loading","error"]),t(u,{label:s.$t("recurring_invoices.frequency.select_frequency"),required:"","content-loading":i.value,error:a.v.selectedFrequency.$error&&a.v.selectedFrequency.$errors[0].$message},{default:d(()=>[t(I,{modelValue:e(n).newRecurringInvoice.selectedFrequency,"onUpdate:modelValue":r[9]||(r[9]=l=>e(n).newRecurringInvoice.selectedFrequency=l),"content-loading":i.value,options:e(n).frequencies,label:"label",invalid:a.v.selectedFrequency.$error,object:"",onChange:y},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),e(R)?(p(),$(u,{key:2,label:s.$t("recurring_invoices.frequency.title"),"content-loading":i.value,required:"",error:a.v.frequency.$error&&a.v.frequency.$errors[0].$message},{default:d(()=>[t(S,{modelValue:e(n).newRecurringInvoice.frequency,"onUpdate:modelValue":[r[10]||(r[10]=l=>e(n).newRecurringInvoice.frequency=l),e(M)],"content-loading":i.value,disabled:!e(R),invalid:a.v.frequency.$error,loading:v.value},null,8,["modelValue","content-loading","disabled","invalid","loading","onUpdate:modelValue"])]),_:1},8,["label","content-loading","error"])):h("",!0),t(ve,{store:e(n),"store-prop":"newRecurringInvoice",v:a.v,"is-loading":a.isLoading,"is-edit":a.isEdit,"customer-currency":e(n).newRecurringInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])])],64)}}},qe=["onSubmit"],Re={class:"flex"},Be={class:"grid-cols-12 gap-8 mt-6 mb-8 lg:grid"},he={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},Ve={class:"w-full relative lg:w-1/2"},Oe={setup(a){const o=E(),k=W(),n=X(),w="newRecurringInvoice",{t:i}=Z();let v=C(!1);const U=C(["customer","company","customerCustom","invoice","invoiceCustom"]);let R=N(),V=ee(),_=q(()=>o.isFetchingInvoice||o.isFetchingInitialSettings),M=q(()=>y.value?i("recurring_invoices.edit_invoice"):i("recurring_invoices.new_invoice")),y=q(()=>R.name==="recurring-invoices.edit");const s={starts_at:{required:f.withMessage(i("validation.required"),b)},status:{required:f.withMessage(i("validation.required"),b)},frequency:{required:f.withMessage(i("validation.required"),b)},limit_by:{required:f.withMessage(i("validation.required"),b)},limit_date:{required:f.withMessage(i("validation.required"),D(function(){return o.newRecurringInvoice.limit_by==="DATE"}))},limit_count:{required:f.withMessage(i("validation.required"),D(function(){return o.newRecurringInvoice.limit_by==="COUNT"}))},selectedFrequency:{required:f.withMessage(i("validation.required"),b)},customer_id:{required:f.withMessage(i("validation.required"),b)},exchange_rate:{required:D(function(){return f.withMessage(i("validation.required"),b),o.showExchangeRate}),decimal:f.withMessage(i("validation.valid_exchange_rate"),ne)}},r=te(s,q(()=>o.newRecurringInvoice),{$scope:w});o.resetCurrentRecurringInvoice(),o.fetchRecurringInvoiceInitialSettings(y.value),n.resetCustomFields(),r.value.$reset,P(()=>o.newRecurringInvoice.customer,c=>{c&&c.currency?o.newRecurringInvoice.currency=c.currency:o.newRecurringInvoice.currency=k.selectedCompanyCurrency});async function B(){if(r.value.$touch(),r.value.$invalid)return!1;v.value=!0;let c={...o.newRecurringInvoice,sub_total:o.getSubTotal,total:o.getTotal,tax:o.getTotalTax};R.params.id?o.updateRecurringInvoice(c).then(u=>{u.data.data&&V.push(`/admin/recurring-invoices/${u.data.data.id}/view`),v.value=!1}).catch(u=>{v.value=!1}):T(c)}function T(c){o.addRecurringInvoice(c).then(u=>{u.data.data&&V.push(`/admin/recurring-invoices/${u.data.data.id}/view`),v.value=!1}).catch(u=>{v.value=!1})}return(c,u)=>{const I=g("BaseBreadcrumbItem"),S=g("BaseBreadcrumb"),l=g("BaseButton"),L=g("router-link"),j=g("BaseIcon"),A=g("BasePageHeader"),G=g("BaseScrollPane"),H=g("BasePage");return p(),x(O,null,[t(oe),t(le),t(me),t(H,{class:"relative invoice-create-page"},{default:d(()=>[m("form",{onSubmit:ae(B,["prevent"])},[t(A,{title:e(M)},{actions:d(()=>[t(L,{to:`/invoices/pdf/${e(o).newRecurringInvoice.unique_hash}`},{default:d(()=>[c.$route.name==="invoices.edit"?(p(),$(l,{key:0,target:"_blank",class:"mr-3",variant:"primary-outline",type:"button"},{default:d(()=>[m("span",Re,F(c.$t("general.view_pdf")),1)]),_:1})):h("",!0)]),_:1},8,["to"]),t(l,{loading:e(v),disabled:e(v),variant:"primary",type:"submit"},{left:d(z=>[e(v)?h("",!0):(p(),$(j,{key:0,name:"SaveIcon",class:ie(z.class)},null,8,["class"]))]),default:d(()=>[re(" "+F(c.$t("recurring_invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:d(()=>[t(S,null,{default:d(()=>[t(I,{title:c.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(I,{title:c.$t("recurring_invoices.title",2),to:"/admin/recurring-invoices"},null,8,["title"]),c.$route.name==="invoices.edit"?(p(),$(I,{key:0,title:c.$t("recurring_invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(p(),$(I,{key:1,title:c.$t("recurring_invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),m("div",Be,[t(we,{v:e(r),"is-loading":e(_),"is-edit":e(y)},null,8,["v","is-loading","is-edit"])]),t(G,null,{default:d(()=>[t(se,{currency:e(o).newRecurringInvoice.currency,"is-loading":e(_),"item-validation-scope":w,store:e(o),"store-prop":"newRecurringInvoice"},null,8,["currency","is-loading","store"]),m("div",he,[m("div",Ve,[t(ce,{store:e(o),"store-prop":"newRecurringInvoice",fields:U.value,type:"Invoice"},null,8,["store","fields"]),t(ge,{type:"Invoice","is-edit":e(y),"is-loading":e(_),store:e(o),"store-prop":"newRecurringInvoice","custom-field-scope":w,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t(de,{store:e(o),"store-prop":"newRecurringInvoice"},null,8,["store"])]),t(ue,{currency:e(o).newRecurringInvoice.currency,"is-loading":e(_),store:e(o),"store-prop":"newRecurringInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],40,qe)]),_:1})],64)}}};export{Oe as default};
