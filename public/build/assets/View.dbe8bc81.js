import{Q as Y,ap as Z,u as ee,I as te,R as ae,e as se,F as re,g as u,x as oe,f as ne,y as le,l as h,K as ie,ab as de,r as n,o as c,c as v,a as s,n as p,w as o,b as l,m as r,J as ce,q as V,t as y,U as b,aa as C,a9 as ue,E as me}from"./main.d0ffa6eb.js";import{_ as fe}from"./CreditNoteIndexDropdown.7ab40c4b.js";import{_ as _e}from"./SendInvoiceModal.67cc3524.js";import{L as pe}from"./LoadingIcon.272413e7.js";const ye={class:"text-sm mr-3"},be={class:"fixed top-0 left-0 hidden h-full pt-16 pb-4 ml-56 bg-white xl:ml-64 w-88 xl:block"},ge={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},he={class:"mb-6"},ve={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},xe={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},Be={key:0,class:"h-full pb-32 overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},ke={class:"flex-2"},Ie={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},we={class:"flex-1 whitespace-nowrap right"},Se={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},Te={class:"flex justify-center p-4 items-center"},Ee={key:0,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},De={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},Fe=["src"],Re={setup($e){Y();const m=Z();ee();const N=te(),A=ae(),{t:_}=se();re("$utils"),u(null),u(null);const d=u(null);u(null);const x=oe(),R=ne();u(["DRAFT","SENT","VIEWED","EXPIRED","ACCEPTED","REJECTED"]);const k=u(!1);u(!1),u(!1);const w=u(!1),g=u(!1),t=le({orderBy:null,orderByField:null,searchText:null}),L=h(()=>d.value.credit_number),S=h(()=>t.orderBy==="asc"||t.orderBy==null);h(()=>S.value?_("general.ascending"):_("general.descending"));const z=h(()=>`/credits/pdf/${d.value.unique_hash}`);h(()=>d.value&&d.value.id?invoice.value.id:null),ie(x,(e,i)=>{e.name==="credit.view"&&E()});async function P(){A.openDialog({title:_("general.are_you_sure"),message:_("creditnote.creditnote_mark_as_sent"),yesLabel:_("general.ok"),noLabel:_("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(async e=>{k.value=!1,e&&(await m.markAsSent({id:d.value.id,status:"SENT"}),d.value.status="SENT",k.value=!0,R.go(0))})}function U(e){return x.params.id==e}async function T(){g.value=!0,await m.fetchCreditNotes(),g.value=!1,setTimeout(()=>{j()},500)}function j(){const e=document.getElementById(`invoice-${x.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"))}async function E(){let e=await m.fetchCreditNote(x.params.id);e.data&&(d.value={...e.data.data})}async function f(){let e="";t.searchText!==""&&t.searchText!==null&&t.searchText!==void 0&&(e+=`search=${t.searchText}&`),t.orderBy!==null&&t.orderBy!==void 0&&(e+=`orderBy=${t.orderBy}&`),t.orderByField!==null&&t.orderByField!==void 0&&(e+=`orderByField=${t.orderByField}`),w.value=!0;let i=await m.searchInvoice(e);w.value=!1,i.data&&(m.invoices=i.data.data)}function M(){return t.orderBy==="asc"?(t.orderBy="desc",f(),!0):(t.orderBy="asc",f(),!0)}return T(),E(),f=de.exports.debounce(f,500),(e,i)=>{const I=n("BaseButton"),q=n("BasePageHeader"),B=n("BaseIcon"),G=n("BaseInput"),D=n("BaseRadio"),F=n("BaseInputGroup"),$=n("BaseDropdownItem"),H=n("BaseDropdown"),J=n("BaseText"),O=n("BaseEstimateStatusBadge"),K=n("BaseFormatMoney"),Q=n("router-link"),W=n("BasePage");return c(),v(C,null,[s(_e),d.value?(c(),p(W,{key:0,class:"xl:pl-96 xl:ml-8"},{default:o(()=>[s(q,{title:r(L)},{actions:o(()=>[l("div",ye,[d.value.is_edit_credit=="1"&&d.value.status==="DRAFT"&&r(N).hasAbilities(r(ce).EDIT_INVOICE)?(c(),p(I,{key:0,disabled:k.value,variant:"primary-outline",onClick:P},{default:o(()=>[V(y(e.$t("invoices.mark_as_sent")),1)]),_:1},8,["disabled"])):b("",!0)]),s(fe,{class:"ml-3",row:d.value,"load-data":T},null,8,["row"])]),_:1},8,["title"]),l("div",be,[l("div",ge,[l("div",he,[s(G,{modelValue:r(t).searchText,"onUpdate:modelValue":i[0]||(i[0]=a=>r(t).searchText=a),placeholder:e.$t("general.search"),type:"text",variant:"gray",onInput:i[1]||(i[1]=a=>f())},{right:o(()=>[s(B,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),l("div",ve,[s(H,{class:"ml-3",position:"bottom-start"},{activator:o(()=>[s(I,{size:"md",variant:"gray"},{default:o(()=>[s(B,{name:"FilterIcon"})]),_:1})]),default:o(()=>[l("div",xe,y(e.$t("general.sort_by")),1),s($,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[s(F,{class:"-mt-3 font-normal"},{default:o(()=>[s(D,{id:"filter_credit_date",modelValue:r(t).orderByField,"onUpdate:modelValue":[i[2]||(i[2]=a=>r(t).orderByField=a),f],label:e.$t("reports.credits.date"),size:"sm",name:"filter",value:"credit_date"},null,8,["modelValue","label"])]),_:1})]),_:1}),s($,{class:"flex px-1 py-2 cursor-pointer"},{default:o(()=>[s(F,{class:"-mt-3 font-normal"},{default:o(()=>[s(D,{id:"filter_credit_number",modelValue:r(t).orderByField,"onUpdate:modelValue":[i[3]||(i[3]=a=>r(t).orderByField=a),f],label:e.$t("credits.number"),value:"credit_number",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),s(I,{class:"ml-1",size:"md",variant:"gray",onClick:M},{default:o(()=>[r(S)?(c(),p(B,{key:0,name:"SortAscendingIcon"})):(c(),p(B,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),r(m)&&r(m).invoices?(c(),v("div",Be,[(c(!0),v(C,null,ue(r(m).invoices,(a,X)=>(c(),v("div",{key:X},[a&&!g.value?(c(),p(Q,{key:0,id:"invoice-"+a.id,to:`/admin/credit-note/${a.id}/view`,class:me(["flex justify-between side-invoice p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":U(a.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:o(()=>[l("div",ke,[s(J,{text:a.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),l("div",Ie,y(a.credit_number),1),s(O,{status:a.status,class:"px-1 text-xs"},{default:o(()=>[V(y(a.status),1)]),_:2},1032,["status"])]),l("div",we,[s(K,{class:"mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900 block",amount:a.total,currency:a.customer.currency},null,8,["amount","currency"]),l("div",Se,y(a.formatted_credit_date),1)])]),_:2},1032,["id","to","class"])):b("",!0)]))),128)),l("div",Te,[g.value?(c(),p(pe,{key:0,class:"h-6 m-1 animate-spin text-primary-400"})):b("",!0)]),!r(m).invoices.length&&!g.value?(c(),v("p",Ee,y(e.$t("invoices.no_matching_invoices")),1)):b("",!0)])):b("",!0)]),l("div",De,[l("iframe",{src:`${r(z)}`,class:"flex-1 border border-gray-400 border-solid bg-white rounded-md frame-style"},null,8,Fe)])]),_:1})):b("",!0)],64)}}};export{Re as default};
