import{ap as N,r,o as f,c as E,a as t,w as i,m as n,P as J,H as Q,a1 as W,ao as X,e as Y,x as Z,f as ee,g as G,l as b,h as v,i as y,a4 as ne,a5 as te,aP as oe,k as ae,K as ie,b as I,n as P,t as q,U as k,E as B,q as M,s as le,aa as re}from"./main.d0ffa6eb.js";import{_ as se,a as de,b as ce,c as ue,d as me}from"./ItemModal.720790e2.js";import{_ as ge}from"./SelectTemplateButton.5704c8fd.js";import{_ as ve}from"./ExchangeRateConverter.ef383681.js";/* empty css                                                                            */import{_ as pe}from"./TaxTypeModal.fd62b2ec.js";import{_ as _e}from"./PreparedByModal.fa78cd8f.js";import"./DragIcon.e0a4ab5f.js";import"./ItemUnitModal.dc6156ec.js";import"./SelectNotePopup.f61bb6cc.js";import"./NoteModal.688693f3.js";/* empty css                                                  */const be={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},fe={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(o){const e=N();function $(d){e.newInvoice.prepared_by_id=d}return(d,a)=>{const V=r("BaseCustomerSelectPopup"),u=r("BaseInputGroup"),p=r("BaseDatePicker"),c=r("BaseInput"),S=r("BasePreparedBySelect"),C=r("BaseInputGrid");return f(),E("div",be,[t(C,{class:"col-span-12 sm:grid-cols-4 md:grid-cols-4"},{default:i(()=>[t(u,{label:d.$t("invoices.client"),"content-loading":o.isLoading,required:""},{default:i(()=>[t(V,{modelValue:n(e).newInvoice.customer,"onUpdate:modelValue":a[0]||(a[0]=l=>n(e).newInvoice.customer=l),valid:o.v.customer_id,"content-loading":o.isLoading,type:"credit",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"])]),_:1},8,["label","content-loading"]),t(u,{label:d.$t("invoices.invoice_date"),"content-loading":o.isLoading},{default:i(()=>[t(p,{disabled:"",modelValue:n(e).newInvoice.invoice_date,"onUpdate:modelValue":a[1]||(a[1]=l=>n(e).newInvoice.invoice_date=l),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",enableTime:"true"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),t(u,{label:d.$t("credits.credit_note_date"),"content-loading":o.isLoading,required:"",error:o.v.credit_date.$error&&o.v.credit_date.$errors[0].$message},{default:i(()=>[t(p,{disabled:"",modelValue:n(e).newInvoice.credit_date,"onUpdate:modelValue":a[2]||(a[2]=l=>n(e).newInvoice.credit_date=l),"content-loading":o.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",enableTime:"true",time24hr:"true"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(u,{label:d.$t("invoices.invoice_number"),"content-loading":o.isLoading},{default:i(()=>[t(c,{disabled:"",modelValue:n(e).newInvoice.invoice_number,"onUpdate:modelValue":a[3]||(a[3]=l=>n(e).newInvoice.invoice_number=l),"content-loading":o.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),t(u,{label:d.$t("credits.credit_note_number"),"content-loading":o.isLoading,error:o.v.credit_number.$error&&o.v.credit_number.$errors[0].$message,required:""},{default:i(()=>[t(c,{disabled:"",modelValue:n(e).newInvoice.credit_number,"onUpdate:modelValue":a[4]||(a[4]=l=>n(e).newInvoice.credit_number=l),"content-loading":o.isLoading,onInput:a[5]||(a[5]=l=>o.v.credit_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),t(u,{label:d.$t("invoices.prepared_by"),"content-loading":o.isLoading},{default:i(()=>[t(S,{type:"Invoice","store-prop":d.newInvoice,store:n(e),"content-loading":o.isLoading,onSelect:$,item:n(e).newInvoice.prepared_by_id},null,8,["store-prop","store","content-loading","item"])]),_:1},8,["label","content-loading"]),t(u,{label:d.$t("creditnote.reason"),"content-loading":o.isLoading},{default:i(()=>[t(c,{modelValue:n(e).newInvoice.reason,"onUpdate:modelValue":a[6]||(a[6]=l=>n(e).newInvoice.reason=l),"content-loading":o.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),t(u,{label:d.$t("Reference"),"content-loading":o.isLoading},{default:i(()=>[t(c,{modelValue:n(e).newInvoice.reference_number,"onUpdate:modelValue":a[7]||(a[7]=l=>n(e).newInvoice.reference_number=l),"content-loading":o.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),t(ve,{store:n(e),"store-prop":"newInvoice",v:o.v,"is-loading":o.isLoading,"is-edit":o.isEdit,"customer-currency":n(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},Ie=["onSubmit"],we={class:"flex"},ye={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},Be={class:"relative w-full lg:w-1/2 lg:mr-4"},$e=I("br",null,null,-1),Me={setup(o){const e=N();J();const $=Q(),d=W();X();const{t:a}=Y();let V=Z(),u=ee();const p="newInvoice";let c=G(!1);const S=b(()=>e.newInvoice.is_edit_credit==1),C=G(["customer","company","customerCustom","invoice","invoiceCustom"]);let l=b(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),D=b(()=>L.value?a("creditnote.edit"):a("creditnote.create")),L=b(()=>V.name==="credit.edit");const R={credit_date:{required:v.withMessage(a("validation.required"),y)},reference_number:{maxLength:v.withMessage(a("validation.price_maxlength"),ne(255))},customer_id:{required:v.withMessage(a("validation.required"),y)},credit_number:{required:v.withMessage(a("validation.required"),y)},exchange_rate:{required:te(function(){return v.withMessage(a("validation.required"),y),e.showExchangeRate}),decimal:v.withMessage(a("validation.valid_exchange_rate"),oe)}},w=ae(R,b(()=>e.newInvoice),{$scope:p});d.resetCustomFields(),w.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(!0),ie(()=>e.newInvoice.customer,s=>{s&&s.currency?e.newInvoice.selectedCurrency=s.currency:e.newInvoice.selectedCurrency=$.selectedCompanyCurrency});async function H(){if(w.value.$touch(),w.value.$invalid)return!1;c.value=!0;let s={...e.newInvoice,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax,prepared_by_id:e.newInvoice.prepared_by_id?e.newInvoice.prepared_by_id.id:""};try{const _=await(L.value?e.updateCreditNote:e.addCreditNote)(s);u.push(`/admin/credit-note/${_.data.data.id}/view`)}catch(m){console.error(m)}c.value=!1}return(s,m)=>{const _=r("BaseBreadcrumbItem"),j=r("BaseBreadcrumb"),h=r("BaseButton"),z=r("router-link"),U=r("BaseIcon"),K=r("BasePageHeader"),F=r("BaseInput"),T=r("BaseInputGroup"),O=r("BaseInputGrid"),x=r("BaseScrollPane"),A=r("BasePage");return f(),E(re,null,[t(se),t(de),t(_e),t(pe),t(A,{class:"relative invoice-create-page"},{default:i(()=>[I("form",{onSubmit:le(H,["prevent"])},[t(K,{title:n(D)},{actions:i(()=>[s.$route.name==="invoices.edit"?(f(),P(z,{key:0,to:`/invoices/pdf/${n(e).newInvoice.unique_hash}`,target:"_blank"},{default:i(()=>[t(h,{class:"mr-3",variant:"primary-outline",type:"button"},{default:i(()=>[I("span",we,q(s.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):k("",!0),t(h,{loading:n(c),disabled:n(c),variant:"primary",type:"submit"},{left:i(g=>[n(c)?k("",!0):(f(),P(U,{key:0,name:"SaveIcon",class:B(g.class)},null,8,["class"]))]),default:i(()=>[M(" "+q(s.$t("creditnote.save")),1)]),_:1},8,["loading","disabled"])]),default:i(()=>[t(j,null,{default:i(()=>[t(_,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(_,{title:s.$t("creditnote.title"),to:"/admin/credit-note"},null,8,["title"]),t(_,{title:s.$t("creditnote.new"),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),t(fe,{v:n(w),"is-loading":n(l),"is-edit":n(L)},null,8,["v","is-loading","is-edit"]),t(x,null,{default:i(()=>[t(ce,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(l),"item-validation-scope":p,store:n(e),"is-draft-mode":n(S),"store-prop":"newInvoice"},null,8,["currency","is-loading","store","is-draft-mode"]),I("div",ye,[I("div",Be,[t(ue,{store:n(e),"store-prop":"newInvoice",fields:C.value,type:"Credit",class:B(n(e).newInvoice.is_edit_credit?n(e).newInvoice.is_edit_credit=="1"?"":"disable":"")},null,8,["store","fields","class"])]),t(me,{currency:n(e).newInvoice.selectedCurrency,"is-loading":n(l),store:n(e),"store-prop":"newInvoice","tax-popup-type":"invoice",class:B(n(e).newInvoice.is_edit_credit?n(e).newInvoice.is_edit_credit=="1"?"":"disable":"")},null,8,["currency","is-loading","store","class"])]),t(O,{class:"sm:grid-cols-4 md:grid-cols-4 col-span-12 mb-4"},{default:i(()=>[t(ge,{store:n(e),"store-prop":"newInvoice","component-name":"InvoiceTemplate"},null,8,["store"]),t(T,{label:s.$t("invoices.upper_margin"),"content-loading":n(l)},{default:i(()=>[t(F,{modelValue:n(e).newInvoice.upper_margin,"onUpdate:modelValue":m[0]||(m[0]=g=>n(e).newInvoice.upper_margin=g),"content-loading":n(l)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),t(T,{label:s.$t("invoices.lower_margin"),"content-loading":n(l)},{default:i(()=>[t(F,{modelValue:n(e).newInvoice.lower_margin,"onUpdate:modelValue":m[1]||(m[1]=g=>n(e).newInvoice.lower_margin=g),"content-loading":n(l)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"])]),_:1}),$e,t(h,{loading:n(c),disabled:n(c),variant:"primary",type:"submit"},{left:i(g=>[n(c)?k("",!0):(f(),P(U,{key:0,name:"SaveIcon",class:B(g.class)},null,8,["class"]))]),default:i(()=>[M(" "+q(s.$t("creditnote.save")),1)]),_:1},8,["loading","disabled"])]),_:1})],40,Ie)]),_:1})],64)}}};export{Me as default};
