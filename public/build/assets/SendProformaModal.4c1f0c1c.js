import{ar as G,Q as H,u as W,R as K,I as Y,e as J,x as Z,f as ee,F as oe,r as w,o as d,n as f,w as r,m as e,a,J as C,S as te,T as ae,q as p,t as g,U as I,H as re,aI as ne,g as j,y as se,l as T,h as S,i as q,j as z,k as le,b as E,c as F,E as ie}from"./main.d0ffa6eb.js";const we={props:{row:{type:Object,default:null},table:{type:Object,default:null},loadData:{type:Function,default:()=>{}}},setup(y){const h=y,k=G(),A=H(),D=W(),$=K(),l=Y(),{t:c}=J(),b=Z(),N=ee(),u=oe("utils");function O(o){return(o.status=="SENT"||o.status=="VIEWED")&&b.name!=="proformas.view"&&l.hasAbilities(C.SEND_INVOICE)}function U(o){return o.status=="DRAFT"&&b.name!=="proformas.view"&&l.hasAbilities(C.SEND_INVOICE)}function x(o){return o.status!="ACCEPTED"&&l.hasAbilities(C.EDIT_INVOICE)}async function L(o){$.openDialog({title:c("general.are_you_sure"),message:c("proformas.confirm_delete"),yesLabel:c("general.ok"),noLabel:c("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(i=>{o=o,i&&k.deleteProforma({ids:[o]}).then(t=>{t.data.success&&(N.push("/admin/proformas"),h.table&&h.table.refresh(),k.$patch(n=>{n.selectedProformas=[],n.selectAllField=!1}))})})}async function s(o){$.openDialog({title:c("general.are_you_sure"),message:c("proformas.confirm_clone"),yesLabel:c("general.ok"),noLabel:c("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(i=>{i&&k.cloneProforma(o).then(t=>{N.push(`/admin/proformas/${t.data.data.id}/edit`)})})}async function M(o){A.openModal({title:c("proformas.send_proforma"),componentName:"SendProformaModal",id:o.id,data:o,variant:"sm"})}function R(){let o=`${window.location.origin}/proformas/pdf/${h.row.unique_hash}`;u.copyTextToClipboard(o),D.showNotification({type:"success",message:c("general.copied_pdf_url_clipboard")})}return(o,i)=>{const t=w("BaseIcon"),n=w("BaseButton"),m=w("BaseDropdownItem"),_=w("router-link"),B=w("BaseDropdown");return d(),f(B,null,{activator:r(()=>[e(b).name==="proformas.view"?(d(),f(n,{key:0,variant:"primary"},{default:r(()=>[a(t,{name:"DotsHorizontalIcon",class:"h-5 text-white"})]),_:1})):(d(),f(t,{key:1,name:"DotsHorizontalIcon",class:"h-5 text-gray-500"}))]),default:r(()=>[e(l).hasAbilities(e(C).EDIT_INVOICE)?(d(),f(_,{key:0,to:`/admin/proformas/${y.row.id}/edit`},{default:r(()=>[te(a(m,null,{default:r(()=>[a(t,{name:"PencilIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+g(o.$t("general.edit")),1)]),_:1},512),[[ae,x(y.row)]])]),_:1},8,["to"])):I("",!0),e(b).name==="proformas.view"?(d(),f(m,{key:1,onClick:R},{default:r(()=>[a(t,{name:"LinkIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+g(o.$t("general.copy_pdf_url")),1)]),_:1})):I("",!0),e(b).name!=="proformas.view"&&e(l).hasAbilities(e(C).VIEW_INVOICE)?(d(),f(_,{key:2,to:`/admin/proformas/${y.row.id}/view`},{default:r(()=>[a(m,null,{default:r(()=>[a(t,{name:"EyeIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+g(o.$t("general.view")),1)]),_:1})]),_:1},8,["to"])):I("",!0),U(y.row)?(d(),f(m,{key:3,onClick:i[0]||(i[0]=P=>M(y.row))},{default:r(()=>[a(t,{name:"PaperAirplaneIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+g(o.$t("proformas.send_proforma")),1)]),_:1})):I("",!0),O(y.row)?(d(),f(m,{key:4,onClick:i[1]||(i[1]=P=>M(y.row))},{default:r(()=>[a(t,{name:"PaperAirplaneIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+g(o.$t("proformas.resend_proforma")),1)]),_:1})):I("",!0),a(_,{to:`/admin/payments/${y.row.id}/create`},{default:r(()=>[y.row.status=="SENT"&&e(b).name!=="proformas.view"?(d(),f(m,{key:0},{default:r(()=>[a(t,{name:"CreditCardIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+g(o.$t("proformas.record_payment")),1)]),_:1})):I("",!0)]),_:1},8,["to"]),e(l).hasAbilities(e(C).CREATE_INVOICE)?(d(),f(m,{key:5,onClick:i[2]||(i[2]=P=>s(y.row))},{default:r(()=>[a(t,{name:"DocumentTextIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+g(o.$t("proformas.clone_proforma")),1)]),_:1})):I("",!0),e(l).hasAbilities(e(C).DELETE_INVOICE)?(d(),f(m,{key:6,onClick:i[3]||(i[3]=P=>L(y.row.id))},{default:r(()=>[a(t,{name:"TrashIcon",class:"w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500"}),p(" "+g(o.$t("general.delete")),1)]),_:1})):I("",!0)]),_:1})}}},ue={class:"flex justify-between w-full"},de={key:0,action:""},me={class:"px-8 py-8 sm:p-6"},ce={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},fe={key:1},pe={class:"my-6 mx-4 border border-gray-200 relative"},ye=p(" Edit "),ve=["src"],ge={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},he={setup(y){const h=H(),k=re(),A=W(),D=G();ne();const{t:$}=J();let l=j(!1);const c=j(""),b=j(!1),N=j(["customer","customerCustom","proforma","proformaCustom","company"]),u=se({id:null,from:null,to:null,subject:"New Proforma",body:null}),O=T(()=>h.active&&h.componentName==="SendProformaModal"),U=T(()=>h.title),x=T(()=>h.data),L={from:{required:S.withMessage($("validation.required"),q),email:S.withMessage($("validation.email_incorrect"),z)},to:{required:S.withMessage($("validation.required"),q),email:S.withMessage($("validation.email_incorrect"),z)},subject:{required:S.withMessage($("validation.required"),q)},body:{required:S.withMessage($("validation.required"),q)}},s=le(L,T(()=>u));function M(){b.value=!1}async function R(){let t=await k.fetchBasicMailConfig();u.id=h.id,t.data&&(u.from=t.data.from_mail),x.value&&(u.to=x.value.customer.email),u.body=k.selectedCompanySettings.proforma_mail_body}async function o(){if(s.value.$touch(),s.value.$invalid)return!0;try{if(l.value=!0,!b.value){const m=await D.previewProforma(u);l.value=!1,b.value=!0;var t=new Blob([m.data],{type:"text/html"});c.value=URL.createObjectURL(t);return}if((await D.sendProforma(u)).data.success)return i(),!0}catch(n){console.error(n),l.value=!1,A.showNotification({type:"error",message:$("proformas.something_went_wrong")})}}function i(){h.closeModal(),setTimeout(()=>{s.value.$reset(),b.value=!1,c.value=null},300)}return(t,n)=>{const m=w("BaseIcon"),_=w("BaseInput"),B=w("BaseInputGroup"),P=w("BaseCustomInput"),Q=w("BaseInputGrid"),V=w("BaseButton"),X=w("BaseModal");return d(),f(X,{show:e(O),onClose:i,onOpen:R},{header:r(()=>[E("div",ue,[p(g(e(U))+" ",1),a(m,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:i})])]),default:r(()=>[b.value?(d(),F("div",fe,[E("div",pe,[a(V,{class:"absolute top-4 right-4",disabled:e(l),variant:"primary-outline",onClick:M},{default:r(()=>[a(m,{name:"PencilIcon",class:"h-5 mr-2"}),ye]),_:1},8,["disabled"]),E("iframe",{src:c.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,ve)]),E("div",ge,[a(V,{class:"mr-3",variant:"primary-outline",type:"button",onClick:i},{default:r(()=>[p(g(t.$t("general.cancel")),1)]),_:1}),a(V,{loading:e(l),disabled:e(l),variant:"primary",type:"button",onClick:n[7]||(n[7]=v=>o())},{default:r(()=>[e(l)?I("",!0):(d(),f(m,{key:0,name:"PaperAirplaneIcon",class:"h-5 mr-2"})),p(" "+g(t.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):(d(),F("form",de,[E("div",me,[a(Q,{layout:"one-column",class:"col-span-7"},{default:r(()=>[a(B,{label:t.$t("general.from"),required:"",error:e(s).from.$error&&e(s).from.$errors[0].$message},{default:r(()=>[a(_,{modelValue:e(u).from,"onUpdate:modelValue":n[0]||(n[0]=v=>e(u).from=v),type:"text",invalid:e(s).from.$error,onInput:n[1]||(n[1]=v=>e(s).from.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(B,{label:t.$t("general.to"),required:"",error:e(s).to.$error&&e(s).to.$errors[0].$message},{default:r(()=>[a(_,{modelValue:e(u).to,"onUpdate:modelValue":n[2]||(n[2]=v=>e(u).to=v),type:"text",invalid:e(s).to.$error,onInput:n[3]||(n[3]=v=>e(s).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(B,{error:e(s).subject.$error&&e(s).subject.$errors[0].$message,label:t.$t("general.subject"),required:""},{default:r(()=>[a(_,{modelValue:e(u).subject,"onUpdate:modelValue":n[4]||(n[4]=v=>e(u).subject=v),type:"text",invalid:e(s).subject.$error,onInput:n[5]||(n[5]=v=>e(s).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["error","label"]),a(B,{label:t.$t("general.body"),error:e(s).body.$error&&e(s).body.$errors[0].$message,required:""},{default:r(()=>[a(P,{modelValue:e(u).body,"onUpdate:modelValue":n[6]||(n[6]=v=>e(u).body=v),fields:N.value},null,8,["modelValue","fields"])]),_:1},8,["label","error"])]),_:1})]),E("div",ce,[a(V,{class:"mr-3",variant:"primary-outline",type:"button",onClick:i},{default:r(()=>[p(g(t.$t("general.cancel")),1)]),_:1}),a(V,{loading:e(l),disabled:e(l),variant:"primary",type:"button",class:"mr-3",onClick:o},{left:r(v=>[e(l)?I("",!0):(d(),f(m,{key:0,class:ie(v.class),name:"PhotographIcon"},null,8,["class"]))]),default:r(()=>[p(" "+g(t.$t("general.preview")),1)]),_:1},8,["loading","disabled"])])]))]),_:1},8,["show"])}}};export{he as _,we as a};
